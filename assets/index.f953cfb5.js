var tt=Object.defineProperty;var it=(r,e,t)=>e in r?tt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var f=(r,e,t)=>(it(r,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();const w={gui:document.getElementById("gui"),items:document.getElementById("items"),tiles:document.getElementById("tiles"),entities:document.getElementById("entities")},ye=class{constructor(e,t){f(this,"connectsToGrass",!1);f(this,"connectsToSand",!1);f(this,"connectsToLava",!1);f(this,"connectsToWater",!1);this.id=e,this.name=t,ye.names[t]=this,ye.tiles[e]=this}render(e,t,i,s){}mayPass(e,t,i,s){return!0}getLightRadius(e,t,i){return 0}hurt(e,t,i,s,n,a,h){}bumpedInto(e,t,i,s){}tick(e,t,i){}steppedOn(e,t,i,s){}interact(e,t,i,s,n,a){return!1}connectsToLiquid(){return this.connectsToWater||this.connectsToLava}};let o=ye;f(o,"names",{}),f(o,"tiles",new Array(256)),f(o,"tickCount",0),f(o,"random",new Math.seedrandom),f(o,"nextInt",function(e){return Math.floor(ye.random.quick()*e)});const st=document.createElement("canvas");st.getContext("2d");class he{constructor(){f(this,"random",new Math.seedrandom);f(this,"x",0);f(this,"y",0);f(this,"xr",6);f(this,"yr",6);f(this,"removed",!1);f(this,"level")}nextInt(e){return Math.floor(this.random.quick()*e)}render(e){}tick(){}remove(){this.removed=!0}init(e){this.level=e}intersects(e,t,i,s){return!(this.x+this.xr<e||this.y+this.yr<t||this.x-this.xr>i||this.y-this.yr>s)}blocks(e){return!1}mobHurt(e,t,i){}tileHurt(e,t,i,s){}move(e,t){if(e!=0||t!=0){let i=!0;if(e!=0&&this.move2(e,0)&&(i=!1),t!=0&&this.move2(0,t)&&(i=!1),!i){let s=this.x>>4,n=this.y>>4;this.level.getTile(s,n).steppedOn(this.level,s,n,this)}return!i}return!0}move2(e,t){if(e!=0&&t!=0)return;let i=this.x-this.xr>>4,s=this.y-this.yr>>4,n=this.x+this.xr>>4,a=this.y+this.yr>>4,h=this.x+e-this.xr>>4,l=this.y+t-this.yr>>4,c=this.x+e+this.xr>>4,u=this.y+t+this.yr>>4,g=!1;for(let p=l;p<=u;p++)for(let I=h;I<=c;I++)if(!(I>=i&&I<=n&&p>=s&&p<=a)&&(this.level.getTile(I,p).bumpedInto(this.level,I,p,this),!this.level.getTile(I,p).mayPass(this.level,I,p,this)))return g=!0,!1;if(g)return!1;let k=this.level.getEntities(this.x-this.xr,this.y-this.yr,this.x+this.xr,this.y+this.yr),y=this.level.getEntities(this.x+e-this.xr,this.y+t-this.yr,this.x+e+this.xr,this.y+t+this.yr);for(let p=0;p<y.length;p++){let I=y[p];I!=this&&I.touchedBy(this)}for(let p=0;p<y.length;p++)k.includes(y[p])&&(y.splice(p,1),p--);for(let p=0;p<y.length;p++){let I=y[p];if(I!=this&&I.blocks(this))return!1}return this.x+=e,this.y+=t,!0}touchedBy(e){}isBlockableBy(e){return!0}touchItem(e){}canSwim(){return!1}interact(e,t,i){return t.interact(e,this,i)}use(e,t){return!1}getLightRadius(){return 0}}function z(r){return()=>{r.pause(),r.currentTime=0,r.play()}}const q={axe:z(new Audio("/assets/sound/axe.ogg")),hoe:z(new Audio("/assets/sound/hoe.ogg")),monsterHurt:z(new Audio("/assets/sound/monsterHurt.ogg")),pickaxe:z(new Audio("/assets/sound/pickaxe.ogg")),pickup:z(new Audio("/assets/sound/pickup.ogg")),shovel:z(new Audio("/assets/sound/shovel.ogg")),stairs:z(new Audio("/assets/sound/stairs.ogg")),sword:z(new Audio("/assets/sound/sword.ogg"))},P=class extends he{static nextGaussian(){for(var e=0,t=0;e===0;)e=P.random.quick();for(;t===0;)t=P.random.quick();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)}constructor(e,t,i){super(),this.x=t,this.y=i,this.time=0,this.zz=2,this.item=e,this.xx=this.x=t,this.yy=this.y=i,this.xr=3,this.yr=3,this.xa=P.nextGaussian()*.3,this.ya=P.nextGaussian()*.2,this.za=P.random.quick()*.7+1,this.lifeTime=60*10+P.nextInt(60)}tick(){if(this.time++,this.time>=this.lifeTime){this.remove();return}this.xx+=this.xa,this.yy+=this.ya,this.zz+=this.za,this.zz<0&&(this.zz=0,this.za*=-.5,this.xa*=.6,this.ya*=.6),this.za-=.15;const e=this.x,t=this.y,i=Math.floor(this.xx),s=Math.floor(this.yy),n=i-this.x,a=s-this.y;this.move(n,a);const h=this.x-e,l=this.y-t;this.xx+=h-n,this.yy+=l-a}isBlockableBy(e){return!1}render(e){if(this.time>=this.lifeTime-6*20&&this.time/6%2==0)return;const{sheet:t,sheetX:i,sheetY:s}=this.item.getSprite();e.render(this.x-4,this.y-4,t,i,s,0,0)}touchedBy(e){this.time>30&&e.touchItem(this)}take(e){q.pickup(),e.score++,this.item.onTake(this),this.remove()}};let L=P;f(L,"random",new Math.seedrandom),f(L,"nextInt",function(e){return Math.floor(P.random.quick()*e)});class be{getColor(){return 0}getSprite(){return{sheet:void 0,sheetX:void 0,sheetY:void 0}}onTake(e){}renderInventory(e,t,i){}interact(e,t,i){return!1}renderIcon(e,t,i){}interactOn(e,t,i,s,n,a){return!1}isDepleted(){return!1}canAttack(){return!1}getAttackDamageBonus(e){return 0}getName(){return""}matches(e){return e.constructor===this.constructor}}const Ye=["ABCDEFGHIJKLMNOPQRSTUVWXYZ012345",`6789.,!?'"-+=/\\%()<>:;`],Ee=28,Xe={};for(let r=Ee;r<Ee+Ye.length;r++)for(let e=0;e<Ye[r-Ee].length;e++)Xe[Ye[r-Ee].substring(e,e+1)]=[8*e,8*r];class b{static draw(e,t,i,s,n){e=e.toUpperCase();for(let a=0;a<e.length;a++)e[a]!==" "&&t.render(i+a*8,s,w.gui,Xe[e[a]][0],Xe[e[a]][1],n,0)}static renderFrame(e,t,i,s,n,a){for(let h=s;h<=a;h++)for(let l=i;l<=n;l++)l==i&&h==s?e.render(l*8,h*8,w.gui,0,21*8,0,0):l==n&&h==s?e.render(l*8,h*8,w.gui,0,21*8,0,1):l==i&&h==a?e.render(l*8,h*8,w.gui,0,21*8,0,2):l==n&&h==a?e.render(l*8,h*8,w.gui,0,21*8,0,3):h==s?e.render(l*8,h*8,w.gui,1*8,21*8,0,0):h==a?e.render(l*8,h*8,w.gui,1*8,21*8,0,2):l==i?e.render(l*8,h*8,w.gui,2*8,21*8,0,0):l==n?e.render(l*8,h*8,w.gui,2*8,21*8,0,1):e.render(l*8,h*8,w.gui,3*8,21*8,0,1);b.draw(t,e,i*8+8,s*8,0)}}class M extends be{constructor(e,t){super(),t===void 0?this.count=1:this.count=t,this.resource=e}getColor(){return this.resource.color}getSprite(){return this.resource.sprite}renderIcon(e,t,i){e.render(t,i,this.resource.sheet,this.resource.sheetX,this.resource.sheetY,0,0)}renderInventory(e,t,i){e.render(t,i,this.resource.sheet,this.resource.sheetX,this.resource.sheetY,0,0),b.draw(this.resource.name,e,t+32,i,0);let s=this.count;s>999&&(s=999),b.draw(""+s,e,t+8,i,0)}getName(){return this.resource.name}onTake(e){}interactOn(e,t,i,s,n,a){return this.resource.interactOn(e,t,i,s,n,a)?(this.count--,!0):!1}isDepleted(){return this.count<=0}}class N{constructor(e,t,i,s,n){this.name=e,this.sheet=t,this.sheetX=i*8,this.sheetY=s*8,this.color=n,this.sprite={sheet:this.sheet,sheetX:this.sheetX,sheetY:this.sheetY}}interactOn(e,t,i,s,n,a){return!1}}class We extends N{constructor(e,t,i,s,n,a,h){super(e,t,i,s,n),this.heal=a,this.staminaCost=h}interactOn(e,t,i,s,n,a){return n.health<n.maxHealth&&n.payStamina(this.staminaCost)?(n.heal(this.heal),!0):!1}}class $ extends N{constructor(e,t,i,s,n,a,...h){super(e,t,i,s,n),this.sourceTiles=h,this.targetTile=a}interactOn(e,t,i,s,n,a){for(let h=0;h<this.sourceTiles.length;h++)if(this.sourceTiles[h].name===e.name)return t.setTile(i,s,this.targetTile,0),!0;return!1}}class d{}f(d,"wood",new N("Wood",w.items,1,0,0)),f(d,"stone",new N("Stone",w.items,2,0,0)),f(d,"flower",new $("Flower",w.items,4,0,0,o.names.flower,o.names.grass)),f(d,"acorn",new $("Acorn",w.items,7,3,0,o.names.treeSapling,o.names.grass)),f(d,"dirt",new $("Dirt",w.items,0,0,0,o.names.dirt,o.names.hole,o.names.water,o.names.lava)),f(d,"sand",new $("Sand",w.items,6,3,0,o.names.sand,o.names.grass,o.names.dirt)),f(d,"cactus",new $("Cactus",w.items,8,3,0,o.names.cactusSapling,o.names.sand)),f(d,"seeds",new $("Seeds",w.items,3,0,0,o.names.wheat,o.names.farmland)),f(d,"wheat",new N("Wheat",w.items,6,0,0)),f(d,"bread",new We("Bread",w.items,7,0,0,2,5)),f(d,"apple",new We("Apple",w.items,16,0,0,1,5)),f(d,"coal",new N("COAL",w.items,2,4,0)),f(d,"ironOre",new N("I.ORE",w.items,3,4,0)),f(d,"goldOre",new N("G.ORE",w.items,5,4,0)),f(d,"ironIngot",new N("IRON",w.items,6,4,0)),f(d,"goldIngot",new N("GOLD",w.items,7,4,0)),f(d,"slime",new N("SLIME",w.items,9,4,0)),f(d,"glass",new N("glass",w.items,10,4,0)),f(d,"cloth",new N("cloth",w.items,11,4,0)),f(d,"cloud",new $("cloud",w.items,2,0,0,o.names.cloud,o.names.infiniteFall)),f(d,"gem",new N("gem",w.items,12,4,0));function nt(){d.acorn.targetTile=o.names.treeSapling,d.acorn.sourceTiles=[o.names.grass],d.flower.targetTile=o.names.flower,d.flower.sourceTiles=[o.names.grass],d.dirt.targetTile=o.names.dirt,d.dirt.sourceTiles=[o.names.hole,o.names.water,o.names.lava],d.sand.targetTile=o.names.sand,d.sand.sourceTiles=[o.names.grass,o.names.dirt],d.cactus.targetTile=o.names.cactusSapling,d.cactus.sourceTiles=[o.names.sand],d.seeds.targetTile=o.names.wheat,d.seeds.sourceTiles=[o.names.farmland],d.cloud.targetTile=o.names.cloud,d.cloud.sourceTiles=[o.names.infiniteFall]}class Ae extends he{constructor(e,t){super(),this.time=0,this.x=e,this.y=t}tick(){this.time++,this.time>10&&this.remove()}render(e){e.render(this.x-8,this.y-8,w.entities,8*8,24*8,0,2),e.render(this.x-0,this.y-8,w.entities,8*8,24*8,0,3),e.render(this.x-8,this.y-0,w.entities,8*8,24*8,0,0),e.render(this.x-0,this.y-0,w.entities,8*8,24*8,0,1)}}const j=class extends he{static nextGaussian(){for(var e=0,t=0;e===0;)e=j.random.quick();for(;t===0;)t=j.random.quick();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)}constructor(e,t,i,s){super(),this.time=0,this.msg=e,this.x=t,this.y=i,this.col=s,this.xx=t,this.yy=i,this.zz=2,this.xa=j.nextGaussian()*.3,this.ya=j.nextGaussian()*.2,this.za=j.random.quick()*.7+2}tick(){this.time++,this.time>60&&this.remove(),this.xx+=this.xa,this.yy+=this.ya,this.zz+=this.za,this.zz<0&&(this.zz=0,this.za*=-.5,this.xa*=.6,this.ya*=.6),this.za-=.15,this.x=Math.floor(this.xx),this.y=Math.floor(this.yy)}render(e){b.draw(this.msg,e,this.x-this.msg.length*4,this.y-Math.floor(this.zz),0)}};let W=j;f(W,"random",new Math.seedrandom);const Ke=5,ee=class{constructor(e,t,i,s){this.name=e,this.sheet=t,this.sheetX=i,this.sheetY=s,this.sprite={sheet:this.sheet,sheetX:this.sheetX,sheetY:this.sheetY},this.sprites=[];for(let n=0;n<Ke;n++)this.sprites.push({sheet:this.sheet,sheetX:this.sheetX,sheetY:this.sheetY+n*8})}};let v=ee;f(v,"shovel",new ee("Shvl",w.items,0*8,13*8)),f(v,"hoe",new ee("Hoe",w.items,1*8,13*8)),f(v,"sword",new ee("Swrd",w.items,2*8,13*8)),f(v,"pickaxe",new ee("Pick",w.items,3*8,13*8)),f(v,"axe",new ee("Axe",w.items,4*8,13*8));const K=class extends be{constructor(e,t){super(),this.toolType=e,this.level=t}getColor(){return K.LEVEL_COLORS[this.level]}getSprite(){return this.toolType.sprites[this.level]}renderIcon(e,t,i){const s=this.toolType.sprites[this.level];e.render(t,i,s.sheet,s.sheetX,s.sheetY,this.getColor(),0)}renderInventory(e,t,i){const s=this.toolType.sprites[this.level];e.render(t,i,s.sheet,s.sheetX,s.sheetY,this.getColor(),0),b.draw(this.getName(),e,t+8,i,0)}getName(){return K.LEVEL_NAMES[this.level]+" "+this.toolType.name}onTake(e){}canAttack(){return!0}getAttackDamageBonus(e){return this.toolType===v.axe?(this.level+1)*2+K.nextInt(4):this.toolType===v.sword?(this.level+1)*3+K.nextInt(2+this.level*this.level*2):1}matches(e){return e instanceof K?!(e.toolType!==this.toolType||e.level!==this.level):!1}};let R=K;f(R,"random",new Math.seedrandom),f(R,"nextInt",function(e){return Math.floor(K.random.quick()*e)}),f(R,"MAX_LEVEL",Ke),f(R,"LEVEL_NAMES",["Wood","Rock","Iron","Gold","Gem"]),f(R,"LEVEL_COLORS",[0,0,0,0,0]);class ve extends he{constructor(){super();f(this,"walkDist",0);f(this,"dir",0);f(this,"hurtTime",0);f(this,"xKnockback",0);f(this,"yKnockback",0);f(this,"maxHealth",10);f(this,"health",this.maxHealth);f(this,"swimTimer",0);f(this,"tickTime",0);this.x=8,this.y=8,this.xr=4,this.yr=3}tick(){this.tickTime++,this.level.getTile(this.x>>4,this.y>>4)==o.lava&&this.hurt(this,4,this.dir^1),this.health<=0&&this.die(),this.hurtTime>0&&this.hurtTime--}die(){this.remove()}move(t,i){return this.isSwimming()&&this.swimTimer++%2==0||(this.xKnockback<0&&(this.move2(-1,0),this.xKnockback++),this.xKnockback>0&&(this.move2(1,0),this.xKnockback--),this.yKnockback<0&&(this.move2(0,-1),this.yKnockback++),this.yKnockback>0&&(this.move2(0,1),this.yKnockback--),this.hurtTime>0)?!0:((t!=0||i!=0)&&(this.walkDist++,t<0&&(this.dir=2),t>0&&(this.dir=3),i<0&&(this.dir=1),i>0&&(this.dir=0)),super.move(t,i))}isSwimming(){let t=this.level.getTile(this.x>>4,this.y>>4).name;return t==o.names.water.name||t==o.names.lava.name}blocks(t){return t.isBlockableBy(this)}tileHurt(t,i,s,n){let a=this.dir^1;this.doHurt(n,a)}mobHurt(t,i,s){this.doHurt(i,s)}heal(t){this.hurtTime>0||(this.level.add(new W(""+t,this.x,this.y,0)),this.health+=t,this.health>this.maxHealth&&(this.health=this.maxHealth))}doHurt(t,i){if(!(this.hurtTime>0)){if(this.level.player!=null){let s=this.level.player.x-this.x,n=this.level.player.y-this.y;s*s+n*n<80*80&&q.monsterHurt()}this.level.add(new W(""+t,this.x,this.y,0)),this.health-=t,i==0&&(this.yKnockback=6),i==1&&(this.yKnockback=-6),i==2&&(this.xKnockback=-6),i==3&&(this.xKnockback=6),this.hurtTime=10}}findStartPos(t){let i=this.nextInt(t.w),s=this.nextInt(t.h),n=i*16+8,a=s*16+8;if(t.player!=null){let l=t.player.x-n,c=t.player.y-a;if(l*l+c*c<80*80)return!1}let h=t.monsterDensity*16;return t.getEntities(n-h,a-h,n+h,a+h).length>0?!1:t.getTile(i,s).mayPass(t,i,s,this)?(this.x=n,this.y=a,!0):!1}}const xe=document.getElementById("canvas"),T={},Me=["HOTBAR_1","HOTBAR_2","HOTBAR_3","HOTBAR_4","HOTBAR_5"],m={MOVE_UP:["w","ArrowUp"],MOVE_DOWN:["s","ArrowDown"],MOVE_RIGHT:["d","ArrowRight"],MOVE_LEFT:["a","ArrowLeft"],ATTACK:["c"],MENU:["x"],HOTBAR_1:["1"],HOTBAR_2:["2"],HOTBAR_3:["3"],HOTBAR_4:["4"],HOTBAR_5:["5"],DEBUG_1:["i"],DEBUG_2:["o"],DEBUG_3:["p"],isPressed:function(r,e){e===void 0&&(e=T);for(let t=0;t<m[r].length;t++){const i=e[m[r][t]];if(i!==void 0&&i[1]>0)return!0}return!1},isClicked:function(r,e){e===void 0&&(e=T);for(let t=0;t<m[r].length;t++){const i=e[m[r][t]];if(i!==void 0&&i[0]===!0)return i[0]=!1,!0}return!1}};function A(r){T[r]===void 0?T[r]=[!0,1]:(T[r][1]+=1,T[r][1]===1&&(T[r][0]=!0))}function rt(r){switch(r.cardinalDirection){case"N":A(m.MOVE_UP[0]),T[m.MOVE_DOWN[0]]=[!1,0],T[m.MOVE_LEFT[0]]=[!1,0],T[m.MOVE_RIGHT[0]]=[!1,0];break;case"NE":A(m.MOVE_UP[0]),A(m.MOVE_RIGHT[0]),T[m.MOVE_DOWN[0]]=[!1,0],T[m.MOVE_LEFT[0]]=[!1,0];break;case"E":A(m.MOVE_RIGHT[0]),T[m.MOVE_LEFT[0]]=[!1,0],T[m.MOVE_UP[0]]=[!1,0],T[m.MOVE_DOWN[0]]=[!1,0];break;case"SE":A(m.MOVE_DOWN[0]),A(m.MOVE_RIGHT[0]),T[m.MOVE_LEFT[0]]=[!1,0],T[m.MOVE_UP[0]]=[!1,0];break;case"S":A(m.MOVE_DOWN[0]),T[m.MOVE_UP[0]]=[!1,0],T[m.MOVE_LEFT[0]]=[!1,0],T[m.MOVE_RIGHT[0]]=[!1,0];break;case"SW":A(m.MOVE_DOWN[0]),A(m.MOVE_LEFT[0]),T[m.MOVE_RIGHT[0]]=[!1,0],T[m.MOVE_UP[0]]=[!1,0];break;case"W":A(m.MOVE_LEFT[0]),T[m.MOVE_RIGHT[0]]=[!1,0],T[m.MOVE_UP[0]]=[!1,0],T[m.MOVE_DOWN[0]]=[!1,0];break;case"NW":A(m.MOVE_LEFT[0]),A(m.MOVE_UP[0]),T[m.MOVE_RIGHT[0]]=[!1,0],T[m.MOVE_DOWN[0]]=[!1,0];break;case"C":T[m.MOVE_UP[0]]=[!1,0],T[m.MOVE_DOWN[0]]=[!1,0],T[m.MOVE_LEFT[0]]=[!1,0],T[m.MOVE_RIGHT[0]]=[!1,0];break}}at();async function at(){if(navigator.maxTouchPoints>1){const r=document.getElementById("joyDiv");for(r.style.display="block";r.clientWidth===0;)await new Promise(s=>setTimeout(s,100));new JoyStick("joyDiv",{},rt);const e=document.getElementById("virtualButtonsContainer");e.style.display="block";const t=document.getElementById("virtualMenuButton"),i=document.getElementById("virtualActionButton");i.addEventListener("touchstart",s=>{A(m.ATTACK[0])}),i.addEventListener("touchend",s=>{T[m.ATTACK[0]]=[!1,0]}),i.addEventListener("touchcancel",s=>{T[m.ATTACK[0]]=[!1,0]}),t.addEventListener("touchstart",s=>{A(m.MENU[0])}),t.addEventListener("touchend",s=>{T[m.MENU[0]]=[!1,0]}),t.addEventListener("touchcancel",s=>{T[m.MENU[0]]=[!1,0]}),xe.addEventListener("touchstart",s=>{const n=s.touches[0],a=(n.clientX-n.target.offsetLeft)/n.target.clientWidth,h=(n.clientY-n.target.offsetTop)/n.target.clientHeight;a<.515||h<.877||(a<.605?A(m.HOTBAR_1[0]):a<.701?A(m.HOTBAR_2[0]):a<.795?A(m.HOTBAR_3[0]):a<.887?A(m.HOTBAR_4[0]):a<.98&&A(m.HOTBAR_5[0]))}),xe.addEventListener("touchend",s=>{T[m.HOTBAR_1[0]]=[!1,0],T[m.HOTBAR_2[0]]=[!1,0],T[m.HOTBAR_3[0]]=[!1,0],T[m.HOTBAR_4[0]]=[!1,0],T[m.HOTBAR_5[0]]=[!1,0]}),xe.addEventListener("touchcancel",s=>{T[m.HOTBAR_1[0]]=[!1,0],T[m.HOTBAR_2[0]]=[!1,0],T[m.HOTBAR_3[0]]=[!1,0],T[m.HOTBAR_4[0]]=[!1,0],T[m.HOTBAR_5[0]]=[!1,0]})}}xe.addEventListener("keydown",function(r){T[r.key]===void 0?T[r.key]=[!0,1]:(T[r.key][1]+=1,T[r.key][1]===1&&(T[r.key][0]=!0))});xe.addEventListener("keyup",function(r){T[r.key]=[!1,0]});class Je{constructor(){this.items=[]}add(e,t){if(t===void 0&&(t=this.items.length),e instanceof M){const i=e,s=this.findResource(i.resource);s===void 0?this.items.splice(t,0,i):s.count+=i.count}else this.items.splice(t,0,e)}findResource(e){for(let t=0;t<this.items.length;t++)if(this.items[t]instanceof M){const i=this.items[t];if(i.resource==e)return i}}hasResource(e,t){const i=this.findResource(e);return i===void 0?!1:i.count>=t}removeResource(e,t){const i=this.findResource(e);return i===void 0||i.count<t?!1:(i.count-=t,i.count<=0&&this.items.splice(this.items.indexOf(i),1),!0)}removeItem(e){this.items.splice(this.items.indexOf(e),1)}count(e){if(e instanceof M){const t=this.findResource(e.resource);if(t!==void 0)return t.count}else{let t=0;for(let i=0;i<this.items.length;i++)this.items[i].matches(e)&&t++;return t}return 0}}class Z extends ve{constructor(e){super(),this.game=e,this.x=24,this.y=24,this.maxStamina=10,this.stamina=this.maxStamina,this.staminaRechargeDelay=0,this.staminaRecharge=0,this.invulnerableTime=0,this.onStairsDelay=0,this.attackTime=0,this.attackDir=0,this.attackItem=void 0,this.activeItem=void 0,this.hotbarItems=[void 0,void 0,void 0,void 0,void 0],this.activeItemIndex=0,this.score=0,this.onStairsDelay=0,this.inventory=new Je}tick(){super.tick(),this.invulnerableTime>0&&this.invulnerableTime--;const e=this.level.getTile(this.x>>4,this.y>>4);if(this.onStairsDelay<=0&&(e==o.names.stairsDown||e==o.names.stairsUp)?(q.stairs(),this.changeLevel(e==o.names.stairsUp?1:-1),this.onStairsDelay=60):this.onStairsDelay>0&&this.onStairsDelay--,this.stamina<=0&&this.staminaRechargeDelay==0&&this.staminaRecharge==0&&(this.staminaRechargeDelay=40),this.staminaRechargeDelay>0&&this.staminaRechargeDelay--,this.staminaRechargeDelay==0)for(this.staminaRecharge++,this.isSwimming()&&(this.staminaRecharge=0);this.staminaRecharge>10;)this.staminaRecharge-=10,this.stamina<this.maxStamina&&this.stamina++;for(let s=0;s<Me.length;s++)m.isClicked(Me[s])&&this.setActiveItemIndex(s);let t=0,i=0;m.isPressed("MOVE_LEFT",T)&&t--,m.isPressed("MOVE_RIGHT",T)&&t++,m.isPressed("MOVE_UP",T)&&i--,m.isPressed("MOVE_DOWN",T)&&i++,this.isSwimming()&&this.tickTime%60==0&&(this.stamina>0?this.stamina--:this.mobHurt(this,1,this.dir^1)),this.staminaRechargeDelay%2==0&&this.move(t,i),m.isClicked("ATTACK",T)&&this.stamina>0&&(this.stamina--,this.staminaRecharge=0,this.attack()),m.isClicked("MENU",T)&&(this.use()||this.game.showInventoryMenu()),this.attackTime>0&&this.attackTime--}playToolSound(){if(!(this.activeItem instanceof R))return;const e=this.activeItem.toolType;e===v.axe?q.axe():e===v.hoe?q.hoe():e===v.pickaxe?q.pickaxe():e===v.sword?q.sword():e===v.shovel&&q.shovel()}attack(){this.walkDist+=8,this.attackDir=this.dir,this.attackItem=this.activeItem;let e=!1;if(this.activeItem!==void 0){this.playToolSound(),this.attackTime=10;let t=-2,i=12;if(this.dir==0&&this.interact(this.x-8,this.y+4+t,this.x+8,this.y+i+t)&&(e=!0),this.dir==1&&this.interact(this.x-8,this.y-i+t,this.x+8,this.y-4+t)&&(e=!0),this.dir==3&&this.interact(this.x+4,this.y-8+t,this.x+i,this.y+8+t)&&(e=!0),this.dir==2&&this.interact(this.x-i,this.y-8+t,this.x-4,this.y+8+t)&&(e=!0),e)return;let s=this.x>>4,n=this.y+t>>4,a=12;this.attackDir==0&&(n=this.y+a+t>>4),this.attackDir==1&&(n=this.y-a+t>>4),this.attackDir==2&&(s=this.x-a>>4),this.attackDir==3&&(s=this.x+a>>4),s>=0&&n>=0&&s<this.level.w&&n<this.level.h&&((this.activeItem.interactOn(this.level.getTile(s,n),this.level,s,n,this,this.attackDir)||this.level.getTile(s,n).interact(this.level,s,n,this,this.activeItem,this.attackDir))&&(e=!0),this.activeItem.isDepleted()&&this.removeDepletedItem())}if(!e&&(this.activeItem==null||this.activeItem.canAttack())){this.attackTime=5;let t=-2,i=20;this.dir==0&&this.doHurtEntities(this.x-8,this.y+4+t,this.x+8,this.y+i+t),this.dir==1&&this.doHurtEntities(this.x-8,this.y-i+t,this.x+8,this.y-4+t),this.dir==3&&this.doHurtEntities(this.x+4,this.y-8+t,this.x+i,this.y+8+t),this.dir==2&&this.doHurtEntities(this.x-i,this.y-8+t,this.x-4,this.y+8+t);let s=this.x>>4,n=this.y+t>>4,a=12;this.attackDir==0&&(n=this.y+a+t>>4),this.attackDir==1&&(n=this.y-a+t>>4),this.attackDir==2&&(s=this.x-a>>4),this.attackDir==3&&(s=this.x+a>>4),s>=0&&n>=0&&s<this.level.w&&n<this.level.h&&this.level.getTile(s,n).hurt(this.level,s,n,this,o.nextInt(3)+1,this.attackDir)}}doHurtEntities(e,t,i,s){const n=this.level.getEntities(e,t,i,s);for(let a=0;a<n.length;a++){const h=n[a];h!=this&&h.mobHurt(this,this.getAttackDamage(h),this.attackDir)}}getAttackDamage(e){let t=this.nextInt(3)+1;return this.attackItem!=null&&(t+=this.attackItem.getAttackDamageBonus(e)),t}use(){return!!(this.dir==0&&this.useRect(this.x-8,this.y+4-2,this.x+8,this.y+12-2)||this.dir==1&&this.useRect(this.x-8,this.y-12-2,this.x+8,this.y-4-2)||this.dir==2&&this.useRect(this.x-12,this.y-8-2,this.x-4,this.y+8-2)||this.dir==3&&this.useRect(this.x+4,this.y-8-2,this.x+12,this.y+8-2))}interact(e,t,i,s){const n=this.level.getEntities(e,t,i,s);for(let a=0;a<n.length;a++){const h=n[a];if(h!=this&&h.interact(this,this.activeItem,this.attackDir))return!0}return!1}useRect(e,t,i,s){const n=this.level.getEntities(e,t,i,s);for(let a=0;a<n.length;a++){const h=n[a];if(h!=this&&h.use(this,this.attackDir))return!0}return!1}removeDepletedItem(){this.inventory.removeItem(this.activeItem);for(let e=0;e<this.hotbarItems.length;e++)this.hotbarItems[e]===this.activeItem&&(this.hotbarItems[e]=void 0);this.hotbarItems[this.activeItemIndex]=void 0,this.activeItem=void 0}setHotbarItem(e,t){this.hotbarItems[e]=t,this.activeItemIndex===e&&(this.activeItem=this.hotbarItems[e])}setActiveItemIndex(e){this.activeItemIndex=e,this.activeItem=this.hotbarItems[e]}payStamina(e){return e>this.stamina?!1:(this.stamina-=e,!0)}render(e){let t=0,i=this.walkDist>>3&1,s=this.walkDist>>3&1;this.dir==1?t+=2:this.dir>1&&(i=0,s=this.walkDist>>4&1,this.dir==2&&(i=1),t+=4+(this.walkDist>>3&1)*2);const n=this.x-8;let a=this.y-11;const h=this.isSwimming();h&&(a+=4,e.render(n+0,a+3,w.gui,5*8,2*8,0,0),e.render(n+8,a+3,w.gui,5*8,2*8,0,1)),e.render(n+8*i,a,w.entities,t*8,16*8,0,i),e.render(n+8-8*i,a,w.entities,(t+1)*8,16*8,0,i),h||(e.render(n+8*s,a+8,w.entities,t*8,17*8,0,s),e.render(n+8-8*s,a+8,w.entities,(t+1)*8,17*8,0,s))}getLightRadius(){let e=2;if(this.activeItem!==void 0&&this.activeItem.furniture!==void 0&&typeof this.activeItem.furniture.getLightRadius=="function"){const t=this.activeItem.furniture.getLightRadius();t>e&&(e=t)}return e}changeLevel(e){this.game.scheduleLevelChange(e)}touchItem(e){e.take(this),this.inventory.add(e.item)}touchedBy(e){e instanceof Z||e.touchedBy(this)}canSwim(){return!0}findStartPos(e){for(;;){const t=this.nextInt(e.w),i=this.nextInt(e.h);if(e.getTile(t,i)==o.names.grass)return this.x=t*16+8,this.y=i*16+8,!0}}}const Te=class extends he{constructor(e,t,i){super(),this.xa=t,this.ya=i,this.x=e.x,this.y=e.y,this.xx=this.x,this.yy=this.y,this.yr=0,this.xr=0,this.time=0,this.owner=e,this.lifeTime=60*10+Te.nextInt(30)}tick(){if(this.time++,this.time>this.lifeTime){this.remove();return}this.xx+=this.xa,this.yy+=this.ya,this.x=Math.floor(this.xx),this.y=Math.floor(this.yy);const e=this.level.getEntities(this.x,this.y,this.x,this.y);for(let t=0;t<e.length;t++){const i=e[t];i instanceof ve&&i!==this.owner&&i.mobHurt(this.owner,1,i.dir^1)}}isBlockableBy(e){return!1}render(e){this.time>=this.lifeTime-6*20&&this.time/6%2==0||e.render(this.x-4,this.y-4-2,w.entities,8*8,24*8,0,Te.nextInt(4))}};let ue=Te;f(ue,"random",new Math.seedrandom),f(ue,"nextInt",function(e){return Math.floor(Te.random.quick()*e)});const G=class extends ve{constructor(){super(),this.xa=0,this.ya=0,this.randomWalkTime=0,this.attackDelay=0,this.attackTime=0,this.attackType=0,this.x=G.nextInt(64*16),this.y=G.nextInt(64*16),this.maxHealth=2e3,this.health=this.maxHealth}tick(){if(super.tick(),this.attackDelay>0){this.dir=(this.attackDelay-45)/4%4,this.dir=this.dir*2%4+this.dir/2,this.attackDelay<45&&(this.dir=0),this.attackDelay--,this.attackDelay==0&&(this.attackType=0,this.health<1e3&&(this.attackType=1),this.health<200&&(this.attackType=2),this.attackTime=60*2);return}if(this.attackTime>0){this.attackTime--;const t=this.attackTime*.25*(this.attackTime%2*2-1),i=.7+this.attackType*.2;this.level.add(new ue(this,Math.cos(t)*i,Math.sin(t)*i));return}if(this.level.player!==void 0&&this.randomWalkTime===0){const t=this.level.player.x-this.x,i=this.level.player.y-this.y;t*t+i*i<32*32?(this.xa=0,this.ya=0,t<0&&(this.xa=1),t>0&&(this.xa=-1),i<0&&(this.ya=1),i>0&&(this.ya=-1)):t*t+i*i>80*80&&(this.xa=0,this.ya=0,t<0&&(this.xa=-1),t>0&&(this.xa=1),i<0&&(this.ya=-1),i>0&&(this.ya=1))}const e=this.tickTime%4==0?0:1;if((!this.move(this.xa*e,this.ya*e)||G.nextInt(100)===0)&&(this.randomWalkTime=30,this.xa=G.nextInt(3)-1,this.ya=G.nextInt(3)-1),this.randomWalkTime>0&&(this.randomWalkTime--,this.level.player!==void 0&&this.randomWalkTime===0)){const t=this.level.player.x-this.x,i=this.level.player.y-this.y;G.nextInt(4)===0&&t*t+i*i<50*50&&this.attackDelay===0&&this.attackTime===0&&(this.attackDelay=60)}}render(e){let t=8;const i=16;let s=this.walkDist>>3&1,n=this.walkDist>>3&1;this.dir==1&&(t+=2),this.dir>1&&(s=0,n=this.walkDist>>4&1,this.dir==2&&(s=1),t+=4+(this.walkDist>>3&1)*2);const a=this.x-8,h=this.y-11;e.render(a+8*s,h+0,w.entities,8*t,8*i,0,s),e.render(a+8-8*s,h+0,w.entities,8*(t+1),8*i,0,s),e.render(a+8*n,h+8,w.entities,8*t,8*(i+1),0,n),e.render(a+8-8*n,h+8,w.entities,8*(t+1),8*(i+1),0,n)}touchedBy(e){e instanceof Z&&e.mobHurt(this,3,this.dir)}die(){super.die()}};let F=G;f(F,"random",new Math.seedrandom),f(F,"nextInt",function(e){return Math.floor(G.random.quick()*e)});const ht={1:ct};let x={};function ot(r){for(var e in x)x.hasOwnProperty(e)&&delete x[e];for(var e in r)x[e]=r[e]}async function lt(r){if(typeof r=="string"&&(r=await dt(r)),r.meta===void 0||r.meta.documentType!=="resourcepack")return;const e=ht[r.meta.documentTypeVersion];if(e!==void 0)return e(r)}async function ct(r){if(r.pack===void 0||r.pack.supportedGameVersionMin===void 0)return;document.getElementById("canvasImageContainer");const e={},t={},i={};if(r.colors!==void 0)for(const s of Object.keys(r.colors))t[s]=r.colors[s],t[s]=[parseInt(t[s].substring(0,2),16),parseInt(t[s].substring(2,4),16),parseInt(t[s].substring(4,6),16)];for(const s of Object.keys(r.files)){if(e[s]=r.files[s],e[s].url===void 0)return;e[s].img=await ut(e[s].url)}for(const s of Object.keys(r.textures)){const n=Object.keys(r.textures[s]),a=r.textures[s],h=e[s].unitSizeX,l=e[s].unitSizeY;for(const c of n){const u=a[c];i[c]=De(e[s].img,u,h,l)}}if(r.textures_cube_generator!==void 0)for(const s of Object.keys(r.textures_cube_generator)){const n=Object.keys(r.textures_cube_generator[s]),a=r.textures_cube_generator[s],h=e[s].unitSizeX,l=e[s].unitSizeY;for(const c of n){const u=a[c],g=u.n**(1/2),k=u.startX,y=u.startY;let p=1;for(let I=y;I<y+g;I++)for(let _=k;_<k+g;_++){const E={x:_,y:I,w:u.w,h:u.h};i[c+p]=De(e[s].img,E,h,l),p+=1}}}if(r.textures_horizontal_generator!==void 0)for(const s of Object.keys(r.textures_horizontal_generator)){const n=Object.keys(r.textures_horizontal_generator[s]),a=r.textures_horizontal_generator[s],h=e[s].unitSizeX,l=e[s].unitSizeY;for(const c of n){const u=a[c],g=u.startX;let k=1;for(let y=g;y<g+u.n;y++){const p={x:y,y:u.startY,w:u.w,h:u.h};i[c+k]=De(e[s].img,p,h,l),k+=1}}}if(r.textures_vertical_generator!==void 0)for(const s of Object.keys(r.textures_vertical_generator)){const n=Object.keys(r.textures_vertical_generator[s]),a=r.textures_vertical_generator[s],h=e[s].unitSizeX,l=e[s].unitSizeY;for(const c of n){const u=a[c],g=u.startY;let k=1;for(let y=g;y<g+u.n;y++){const p={x:u.startX,y,w:u.w,h:u.h};i[c+k]=De(e[s].img,p,h,l),k+=1}}}if(r.paint_rules!==void 0){const s=[];for(let a=0;a<r.paint_rules.length;a++)s.push(r.paint_rules[a]),s[a].match=new RegExp(s[a].match);const n=Object.keys(i);for(const a of n)for(let h=0;h<s.length;h++)if(s[h].match.test(a)){const l=i[a],c=l.getContext("2d"),u=c.getImageData(0,0,l.width,l.height),{data:g}=u;for(let k=0;k<g.length;k+=4){const y=g[k+0],p=g[k+1],I=g[k+2];for(let _=0;_<s[h].paint.length;_++){const E=t[s[h].paint[_][0]];if(y===E[0]&&p===E[1]&&I===E[2]){const D=t[s[h].paint[_][1]];g[k+0]=D[0],g[k+1]=D[1],g[k+2]=D[2]}}}c.putImageData(u,0,0);break}}return i}function De(r,e,t,i){const s=document.createElement("canvas"),n=s.getContext("2d"),a=e.x*t,h=e.y*i;let l=t,c=i;return e.w!==void 0&&(l=e.w*t),e.h!==void 0&&(c=e.h*i),s.width=l,s.height=c,n.drawImage(r,a,h,l,c,0,0,l,c),s}async function dt(r){return await fetch(r).then(t=>t.json())}async function ut(r){return new Promise((e,t)=>{const i=new Image;i.onload=()=>e(i),i.onerror=t,i.src=r})}const Ie={true:{true:1,false:4},false:{true:2,false:5}},Ce={true:{true:3,false:6},false:{true:2,false:5}},_e={true:{true:7,false:4},false:{true:8,false:5}},Oe={true:{true:9,false:6},false:{true:8,false:5}};class Ze extends o{constructor(){super(...arguments);f(this,"connectsToGrass",!0)}render(t,i,s,n){let a=!i.getTile(s,n-1).connectsToGrass,h=!i.getTile(s,n+1).connectsToGrass,l=!i.getTile(s-1,n).connectsToGrass,c=!i.getTile(s+1,n).connectsToGrass;!a&&!l?t.renderTexture(16*s,16*n,x.grass_1,0):t.renderTexture(16*s,16*n,x["grass_connector_"+Ie[l][a]],0),!a&&!c?t.renderTexture(16*s+8,16*n,x.grass_2,0):t.renderTexture(16*s+8,16*n,x["grass_connector_"+Ce[c][a]],0),!h&&!l?t.renderTexture(16*s,16*n+8,x.grass_3,0):t.renderTexture(16*s,16*n+8,x["grass_connector_"+_e[l][h]],0),!h&&!c?t.renderTexture(16*s+8,16*n+8,x.grass_4,0):t.renderTexture(16*s+8,16*n+8,x["grass_connector_"+Oe[c][h]],0)}tick(t,i,s){let n=i,a=s;o.nextInt(10)===0&&(o.nextInt(2)===1?n+=o.nextInt(2)*2-1:a+=o.nextInt(2)*2-1,t.getTile(n,a).name==o.names.dirt.name&&t.setTile(n,a,o.names.grass,0))}interact(t,i,s,n,a,h){return a instanceof R?a.toolType===v.shovel?n.payStamina(4-a.level)?(o.nextInt(5)===0&&t.add(new L(new M(d.seeds),i*16+o.nextInt(10)+3,s*16+o.nextInt(10)+3)),t.setTile(i,s,o.names.dirt,0),!0):!1:a.toolType===v.hoe?n.payStamina(4-a.level)?(o.nextInt(5)===0&&t.add(new L(new M(d.seeds),i*16+o.nextInt(10)+3,s*16+o.nextInt(10)+3)),t.setTile(i,s,o.names.farmland,0),!0):!1:!0:!1}}class Qe extends o{render(e,t,i,s){let n=t.getTile(i,s-1).id!=this.id,a=t.getTile(i,s+1).id!=this.id,h=t.getTile(i-1,s).id!=this.id,l=t.getTile(i+1,s).id!=this.id;!n&&!h?e.renderTexture(16*i,16*s,x.rock_1,0):e.renderTexture(16*i,16*s,x["rock_connector_"+Ie[h][n]],0),!n&&!l?e.renderTexture(16*i+8,16*s,x.rock_2,0):e.renderTexture(16*i+8,16*s,x["rock_connector_"+Ce[l][n]],0),!a&&!h?e.renderTexture(16*i,16*s+8,x.rock_3,0):e.renderTexture(16*i,16*s+8,x["rock_connector_"+_e[h][a]],0),!a&&!l?e.renderTexture(16*i+8,16*s+8,x.rock_4,0):e.renderTexture(16*i+8,16*s+8,x["rock_connector_"+Oe[l][a]],0)}mayPass(e,t,i,s){return!1}hurt(e,t,i,s,n,a){const h=e.getData(t,i)+n;if(e.add(new Ae(t*16+8,i*16+8)),e.add(new W(""+n,t*16+8,i*16+8,0)),h>=50){let l=o.nextInt(4)+1;for(let c=0;c<l;c++)e.add(new L(new M(d.stone),t*16+o.nextInt(10)+3,i*16+o.nextInt(10)+3));l=o.nextInt(2);for(let c=0;c<l;c++)e.add(new L(new M(d.coal),t*16+o.nextInt(10)+3,i*16+o.nextInt(10)+3));e.setTile(t,i,o.names.dirt,0)}else e.setData(t,i,h)}interact(e,t,i,s,n,a){return!(n instanceof R)||n.toolType!==v.pickaxe||!s.payStamina(4-n.level)?!1:(this.hurt(e,t,i,s,o.nextInt(10)+n.level*5+10,a),!0)}tick(e,t,i){const s=e.getData(t,i);s>0&&e.setData(t,i,s-1)}}const Re=class extends o{render(e,t,i,s){const n=Re.flips[o.tickCount%Re.flips.length];e.renderTexture(i*16+0,s*16+0,x.water_1,n),e.renderTexture(i*16+8,s*16+0,x.water_2,n),e.renderTexture(i*16+0,s*16+8,x.water_3,n),e.renderTexture(i*16+8,s*16+8,x.water_4,n)}mayPass(e,t,i,s){return s.canSwim()}};let ge=Re;f(ge,"flips",[]);for(let r=0;r<=3;r++)for(let e=0;e<25;e++)ge.flips.push(r);class ft extends Ze{constructor(){super(...arguments);f(this,"connectsToGrass",!0)}render(t,i,s,n){super.render(t,i,s,n),i.getData(s,n)/16%2==0?(t.renderTexture(s*16+0,n*16+0,x.flower,0),t.renderTexture(s*16+8,n*16+8,x.flower,0)):(t.renderTexture(s*16+8,n*16+0,x.flower,0),t.renderTexture(s*16+0,n*16+8,x.flower,0))}interact(t,i,s,n,a,h){}hurt(t,i,s,n,a,h){const l=o.nextInt(2)+1;for(let c=0;c<l;c++)t.add(new L(new M(d.flower),i*16+o.nextInt(10)+3,s*16+o.nextInt(10)+3));t.setTile(i,s,o.names.grass,0)}}class mt extends o{constructor(){super(...arguments);f(this,"connectsToGrass",!0)}render(t,i,s,n){o.tiles[0].render(t,i,s,n),t.renderTexture(16*s,16*n,x.tree,0,0)}tick(t,i,s){let n=t.getData(i,s);n>0&&t.setData(i,s,n-1)}mayPass(t,i,s,n){return!1}hurt(t,i,s,n,a,h){this.internalHurt(t,i,s,a)}interact(t,i,s,n,a,h){return!(a instanceof R)||a.toolType!==v.axe||!n.payStamina(4-a.level)?!1:(this.internalHurt(t,i,s,o.nextInt(10)+a.level*5+10),!0)}internalHurt(t,i,s,n){let a=o.nextInt(10)==0?1:0;for(let l=0;l<a;l++)t.add(new L(new M(d.apple),i*16+o.nextInt(10)+3,s*16+o.nextInt(10)+3));let h=t.getData(i,s)+n;if(t.add(new Ae(i*16+8,s*16+8)),t.add(new W(""+n,i*16+8,s*16+8,0)),h>=20){let l=o.nextInt(2)+1;for(let c=0;c<l;c++)t.add(new L(new M(d.wood),i*16+o.nextInt(10)+3,s*16+o.nextInt(10)+3));l=o.nextInt(o.nextInt(4)+1);for(let c=0;c<l;c++)t.add(new L(new M(d.acorn),i*16+o.nextInt(10)+3,s*16+o.nextInt(10)+3));t.setTile(i,s,o.names.grass,0)}else t.setData(i,s,h)}}class pt extends o{render(e,t,i,s){e.renderTexture(i*16,s*16,x.dirt_1,0),e.renderTexture(i*16+8,s*16,x.dirt_2,0),e.renderTexture(i*16,s*16+8,x.dirt_3,0),e.renderTexture(i*16+8,s*16+8,x.dirt_4,0)}interact(e,t,i,s,n,a){if(!(n instanceof R))return!1;if(n.toolType===v.shovel)return s.payStamina(4-n.level)?(e.add(new L(new M(d.dirt),t*16+o.nextInt(10)+3,i*16+o.nextInt(10)+3)),e.setTile(t,i,o.names.hole,0),!0):!1;if(n.toolType===v.hoe)return s.payStamina(4-n.level)?(e.setTile(t,i,o.names.farmland,0),!0):!1}}class xt extends o{constructor(){super(...arguments);f(this,"connectsToSand",!0)}render(t,i,s,n){let a=!i.getTile(s,n-1).connectsToSand,h=!i.getTile(s,n+1).connectsToSand,l=!i.getTile(s-1,n).connectsToSand,c=!i.getTile(s+1,n).connectsToSand;!a&&!l?t.renderTexture(16*s,16*n,x.sand_1,0):t.renderTexture(16*s,16*n,x["sand_connector_"+Ie[l][a]],0),!a&&!c?t.renderTexture(16*s+8,16*n,x.sand_2,0):t.renderTexture(16*s+8,16*n,x["sand_connector_"+Ce[c][a]],0),!h&&!l?t.renderTexture(16*s,16*n+8,x.sand_3,0):t.renderTexture(16*s,16*n+8,x["sand_connector_"+_e[l][h]],0),!h&&!c?t.renderTexture(16*s+8,16*n+8,x.sand_4,0):t.renderTexture(16*s+8,16*n+8,x["sand_connector_"+Oe[c][h]],0)}interact(t,i,s,n,a,h){return!(a instanceof R)||a.toolType!==v.shovel||!n.payStamina(4-a.level)?!1:(t.add(new L(new M(d.sand),i*16+o.nextInt(10)+3,s*16+o.nextInt(10)+3)),t.setTile(i,s,o.names.dirt,0),!0)}}class gt extends o{constructor(){super(...arguments);f(this,"connectsToSand",!0)}render(t,i,s,n){o.tiles[6].render(t,i,s,n),t.renderTexture(s*16,n*16,x.cactus,0)}mayPass(t,i,s,n){return!1}bumpedInto(t,i,s,n){n.tileHurt(this,i,s,1)}}class wt extends o{constructor(){super(...arguments);f(this,"connectsToSand",!0);f(this,"connectsToWater",!0);f(this,"connectsToLava",!0)}render(t,i,s,n){let a=!i.getTile(s,n-1).connectsToLiquid(),h=!i.getTile(s,n+1).connectsToLiquid(),l=!i.getTile(s-1,n).connectsToLiquid(),c=!i.getTile(s+1,n).connectsToLiquid();!a&&!l?t.renderTexture(16*s,16*n,x.hole_1,0):t.renderTexture(16*s,16*n,x["hole_connector_"+Ie[l][a]],0),!a&&!c?t.renderTexture(16*s+8,16*n,x.hole_2,0):t.renderTexture(16*s+8,16*n,x["hole_connector_"+Ce[c][a]],0),!h&&!l?t.renderTexture(16*s,16*n+8,x.hole_3,0):t.renderTexture(16*s,16*n+8,x["hole_connector_"+_e[l][h]],0),!h&&!c?t.renderTexture(16*s+8,16*n+8,x.hole_4,0):t.renderTexture(16*s+8,16*n+8,x["hole_connector_"+Oe[c][h]],0)}mayPass(t,i,s,n){return n.canSwim()}}class ze extends o{constructor(e,t,i,s){super(e,t),this.onType=i,this.growsTo=s}render(e,t,i,s){this.onType.render(e,t,i,s),e.renderTexture(i*16+4,s*16+4,x.treeSapling,0)}tick(e,t,i){const s=e.getData(t,i)+1;s>100?e.setTile(t,i,this.growsTo,0):e.setData(t,i,s)}hurt(e,t,i,s,n,a){e.setTile(t,i,this.onType,0)}}class yt extends o{render(e,t,i,s){e.renderTexture(i*16+0,s*16+0,x.farm,1),e.renderTexture(i*16+8,s*16+0,x.farm,0),e.renderTexture(i*16+0,s*16+8,x.farm,0),e.renderTexture(i*16+8,s*16+8,x.farm,1)}tick(e,t,i){let s=e.getData(t,i);s<5&&e.setData(t,i,s+1)}interact(e,t,i,s,n,a){return n instanceof R&&n.toolType===v.shovel&&s.payStamina(4-n.level)?(e.setTile(t,i,o.names.dirt,0),!0):!1}steppedOn(e,t,i,s){}}class Tt extends o{render(e,t,i,s){let n=t.getData(i,s),a=Math.floor(n/10);a>5&&(a=5),a++,e.renderTexture(i*16+0,s*16+0,x.farm,1),e.renderTexture(i*16+8,s*16+0,x.farm,0),e.renderTexture(i*16+0,s*16+8,x.farm,0),e.renderTexture(i*16+8,s*16+8,x.farm,1);const h=x["wheat_"+a];e.renderTexture(i*16+0,s*16+0,h,0),e.renderTexture(i*16+8,s*16+0,h,0),e.renderTexture(i*16+0,s*16+8,h,1),e.renderTexture(i*16+8,s*16+8,h,1)}tick(e,t,i){if(o.nextInt(2)===0)return;let s=e.getData(t,i);s<50&&e.setData(t,i,s+1)}hurt(e,t,i,s,n,a,h){this.harvest(e,t,i)}harvest(e,t,i){let s=e.getData(t,i),n=o.nextInt(2);for(let a=0;a<n;a++)e.add(new L(new M(d.seeds),t*16+o.nextInt(10)+3,i*16+o.nextInt(10)+3));n=0,s==50?n=o.nextInt(3)+2:s>=40&&(n=o.nextInt(2)+1);for(let a=0;a<n;a++)e.add(new L(new M(d.wheat),t*16+o.nextInt(10)+3,i*16+o.nextInt(10)+3));e.setTile(t,i,o.names.dirt,0)}}class kt extends o{render(e,t,i,s){e.renderTexture(i*16+0,s*16+0,x.lava_1,0),e.renderTexture(i*16+8,s*16+0,x.lava_2,0),e.renderTexture(i*16+0,s*16+8,x.lava_3,0),e.renderTexture(i*16+8,s*16+8,x.lava_4,0)}mayPass(e,t,i,s){return s.canSwim()}getLightRadius(e,t,i){return 6}}class qe extends o{constructor(e,t,i){super(e,t),this.leadsUp=i}render(e,t,i,s){e.renderTexture(i*16,s*16,this.leadsUp?x.stairs_up:x.stairs_down,0)}}class vt extends o{render(e,t,i,s){e.renderTexture(i*16,s*16,x.infinite_fall_1,0),e.renderTexture(i*16+8,s*16,x.infinite_fall_2,0),e.renderTexture(i*16,s*16+8,x.infinite_fall_3,0),e.renderTexture(i*16+8,s*16+8,x.infinite_fall_4,0)}mayPass(e,t,i,s){return s instanceof F}}class It extends o{render(e,t,i,s){let n=t.getTile(i,s-1).id===o.names.infiniteFall.id,a=t.getTile(i,s+1).id===o.names.infiniteFall.id,h=t.getTile(i-1,s).id===o.names.infiniteFall.id,l=t.getTile(i+1,s).id===o.names.infiniteFall.id;!n&&!h?e.renderTexture(16*i,16*s,x.cloud_1,0):e.renderTexture(16*i,16*s,x["cloud_connector_"+Ie[h][n]],0),!n&&!l?e.renderTexture(16*i+8,16*s,x.cloud_2,0):e.renderTexture(16*i+8,16*s,x["cloud_connector_"+Ce[l][n]],0),!a&&!h?e.renderTexture(16*i,16*s+8,x.cloud_3,0):e.renderTexture(16*i,16*s+8,x["cloud_connector_"+_e[h][a]],0),!a&&!l?e.renderTexture(16*i+8,16*s+8,x.cloud_4,0):e.renderTexture(16*i+8,16*s+8,x["cloud_connector_"+Oe[l][a]],0)}}class Ct extends Qe{interact(e,t,i,s,n,a){return!(n instanceof R)||n.toolType!==v.pickaxe||n.level<4||!s.payStamina(4-n.level)?!1:(this.hurt(e,t,i,s,o.nextInt(10)+n.level*5+10,a),!0)}}class Ge extends o{constructor(e,t,i){super(e,t),this.resourceDrop=i}mayPass(e,t,i,s){return!1}interact(e,t,i,s,n,a){return!(n instanceof R)||n.toolType!==v.pickaxe||!s.payStamina(6-n.level)?!1:(this.hurt(e,t,i,s,o.nextInt(10)+n.level*5+10,a),!0)}hurt(e,t,i,s,n,a){const h=e.getData(t,i)+1;if(e.add(new Ae(t*16+8,i*16+8)),e.add(new W(""+n,t*16+8,i*16+8,0)),h>0){let l=o.nextInt(2);h>=o.nextInt(10)+3?(e.setTile(t,i,o.names.dirt,0),l+=2):e.setData(t,i,h);for(let c=0;c<l;c++)e.add(new L(new M(this.resourceDrop,1),t*16+o.nextInt(10)+3,i*16+o.nextInt(10)+3))}}}class _t extends Ge{constructor(e,t){super(e,t,d.ironOre)}render(e,t,i,s){e.renderTexture(i*16,s*16,x.iron_ore,0)}}class Ot extends Ge{constructor(e,t){super(e,t,d.goldOre)}render(e,t,i,s){e.renderTexture(i*16,s*16,x.gold_ore,0)}}class Et extends Ge{constructor(e,t){super(e,t,d.gem)}render(e,t,i,s){e.renderTexture(i*16,s*16,x.gem_ore,0)}}class Dt extends o{render(e,t,i,s){e.renderTexture(i*16,s*16,x.cloud_cactus,0)}mayPass(e,t,i,s){return s instanceof F}interact(e,t,i,s,n,a){return!(n instanceof R)||n.toolType!==v.pickaxe||!s.payStamina(6-n.level)?!1:(this.hurt(e,t,i,s,1,a),!0)}hurt(e,t,i,s,n,a){const h=e.getData(t,i)+1;e.add(new Ae(t*16+8,i*16+8)),e.add(new W(""+n,t*16+8,i*16+8,0)),h>=10?e.setTile(t,i,o.names.cloud,0):e.setData(t,i,h)}bumpedInto(e,t,i,s){s instanceof F||s.tileHurt(this,t,i,3)}}function St(){new Ze(0,"grass"),new Qe(1,"rock"),new ge(2,"water"),new ft(3,"flower"),new mt(4,"tree"),new pt(5,"dirt"),new xt(6,"sand"),new gt(7,"cactus"),new wt(8,"hole"),new ze(9,"treeSapling",o.names.grass,o.names.tree),new ze(10,"cactusSapling",o.names.sand,o.names.cactus),new yt(11,"farmland"),new Tt(12,"wheat"),new kt(13,"lava"),new qe(14,"stairsDown",!1),new qe(15,"stairsUp",!0),new vt(16,"infiniteFall"),new It(17,"cloud"),new Ct(18,"hardRock"),new _t(19,"ironOre"),new Ot(20,"goldOre"),new Et(21,"gemOre"),new Dt(22,"cloudCactus"),nt()}St();let fe=new Math.seedrandom("123123871283");function O(r){return Math.floor(fe.quick()*r)}class H{constructor(e,t,i){this.h=t,this.w=t,this.values=[];for(let h=0;h<e;h+=i)for(let l=0;l<e;l+=i)this.setSample(l,h,fe.quick()*2-1);let s=i,n=1/e,a=1;do{let h=s/2;for(let l=0;l<e;l+=s)for(let c=0;c<e;c+=s){let u=this.sample(c,l),g=this.sample(c+s,l),k=this.sample(c,l+s),y=this.sample(c+s,l+s),p=(u+g+k+y)/4+(fe.quick()*2-1)*s*n;this.setSample(c+h,l+h,p)}for(let l=0;l<e;l+=s)for(let c=0;c<e;c+=s){let u=this.sample(c,l),g=this.sample(c+s,l);this.sample(c,l+s);let k=this.sample(c+h,l+h),y=this.sample(c+h,l-h),p=this.sample(c-h,l+h),I=(u+g+k+y)/4+(fe.quick()*2-1)*s*n*.5,_=(u+g+k+p)/4+(fe.quick()*2-1)*s*n*.5;this.setSample(c+h,l,I),this.setSample(c,l+h,_)}s/=2,n*=a+.8,a*=.3}while(s>1)}sample(e,t){return this.values[(e&this.w-1)+(t&this.h-1)*this.w]}setSample(e,t,i){this.values[(e&this.w-1)+(t&this.h-1)*this.w]=i}}function Mt(r,e){do{let t=At(r,e),i=new Array(256);for(let s=0;s<r*e;s++)i[t[0][s]&255]++;if(!(i[o.names.rock.id&255]<100)&&!(i[o.names.sand.id&255]<100)&&!(i[o.names.grass.id&255]<100)&&!(i[o.names.tree.id&255]<100)&&!(i[o.names.stairsDown.id&255]<2))return t}while(!0)}function Rt(r,e,t){do{let i=Lt(r,e,t),s=new Array(256);for(let n=0;n<r*e;n++)s[i[0][n]&255]++;if(!(s[o.names.rock.id&255]<100)&&!(s[o.names.dirt.id&255]<100)&&!(s[(o.names.ironOre.id&255)+t-1]<20)&&!(t<3&&s[o.names.stairsDown.id&255]<2))return i}while(!0)}function bt(r,e){do{let t=Ht(r,e),i=new Array(256);for(let s=0;s<r*e;s++)i[t[0][s]&255]++;if(!(i[o.names.cloud.id&255]<2e3)&&!(i[o.names.stairsDown.id&255]<2))return t}while(!0)}function At(r,e){let t=new H(r,e,16),i=new H(r,e,16),s=new H(r,e,16),n=new H(r,e,32),a=new H(r,e,32),h=new Array(r*e),l=new Array(r*e);for(let u=0;u<e;u++)for(let g=0;g<r;g++){let k=g+u*r,y=Math.abs(n.values[k]-a.values[k])*3-2,p=Math.abs(t.values[k]-i.values[k]);p=Math.abs(p-s.values[k])*3-2;let I=g/(r-1)*2-1,_=u/(e-1)*2-1;I<0&&(I=-I),_<0&&(_=-_);let E=I>=_?I:_;E=E*E*E*E,E=E*E*E*E,y=y+1-E*20,y<-.5?h[k]=o.names.water.id:y>.5&&p<-1.5?h[k]=o.names.rock.id:h[k]=o.names.grass.id}for(let u=0;u<r*e/2800;u++){let g=O(r),k=O(e);for(let y=0;y<10;y++){let p=g+O(21)-10,I=k+O(21)-10;for(let _=0;_<100;_++){let E=p+O(5)-O(5),D=I+O(5)-O(5);for(let B=D-1;B<=D+1;B++)for(let V=E-1;V<=E+1;V++)V>=0&&B>=0&&V<r&&B<e&&h[V+B*r]==o.names.grass.id&&(h[V+B*r]=o.names.sand.id)}}}for(let u=0;u<r*e/400;u++){let g=O(r),k=O(e);for(let y=0;y<200;y++){let p=g+O(15)-O(15),I=k+O(15)-O(15);p>=0&&I>=0&&p<r&&I<e&&h[p+I*r]==o.names.grass.id&&(h[p+I*r]=o.names.tree.id)}}for(let u=0;u<r*e/400;u++){let g=O(r),k=O(e),y=O(4);for(let p=0;p<30;p++){let I=g+O(5)-O(5),_=k+O(5)-O(5);I>=0&&_>=0&&I<r&&_<e&&h[I+_*r]==o.names.grass.id&&(h[I+_*r]=o.names.flower.id,l[I+_*r]=y+O(4)*16)}}for(let u=0;u<r*e/100;u++){let g=O(r),k=O(e);g>=0&&k>=0&&g<r&&k<e&&h[g+k*r]==o.names.sand.id&&(h[g+k*r]=o.names.cactus.id)}let c=0;e:for(let u=0;u<r*e/100;u++){let g=O(r-2)+1,k=O(e-2)+1;for(let y=k-1;y<=k+1;y++)for(let p=g-1;p<=g+1;p++)if(h[p+y*r]!=o.names.rock.id)continue e;if(h[g+k*r]=o.names.stairsDown.id,c++,c==4)break}return[h,l]}function Lt(r,e,t){let i=new H(r,e,16),s=new H(r,e,16),n=new H(r,e,16),a=new H(r,e,16),h=new H(r,e,16),l=new H(r,e,16),c=new H(r,e,16),u=new H(r,e,16),g=new H(r,e,16),k=new H(r,e,32),y=new H(r,e,32),p=new Array(r*e),I=new Array(r*e);for(let _=0;_<e;_++)for(let E=0;E<r;E++){let D=E+_*r,B=Math.abs(k.values[D]-y.values[D])*3-2,V=Math.abs(i.values[D]-s.values[D]);V=Math.abs(V-n.values[D])*3-2;let Y=Math.abs(a.values[D]-h.values[D]);Y=Math.abs(Y-l.values[D])*3-2;let Q=Math.abs(c.values[D]-u.values[D]);Q=Math.abs(Y-g.values[D])*3-2;let le=E/(r-1)*2-1,ce=_/(e-1)*2-1;le<0&&(le=-le),ce<0&&(ce=-ce);let X=le>=ce?le:ce;X=X*X*X*X,X=X*X*X*X,B=B+1-X*20,B>-2&&Q<-2+t/2*3?t>2?p[D]=o.names.lava.id:p[D]=o.names.water.id:B>-2&&(V<-1.7||Y<-1.4)?p[D]=o.names.dirt.id:p[D]=o.names.rock.id}{let _=2;for(let E=0;E<r*e/400;E++){let D=O(r),B=O(e);for(let V=0;V<30;V++){let Y=D+O(5)-O(5),Q=B+O(5)-O(5);Y>=_&&Q>=_&&Y<r-_&&Q<e-_&&p[Y+Q*r]==o.names.rock.id&&(p[Y+Q*r]=(o.names.ironOre.id&255)+t-1)}}}if(t<3){let _=0;e:for(let E=0;E<r*e/100;E++){let D=O(r-20)+10,B=O(e-20)+10;for(let V=B-1;V<=B+1;V++)for(let Y=D-1;Y<=D+1;Y++)if(p[Y+V*r]!=o.names.rock.id)continue e;if(p[D+B*r]=o.names.stairsDown.id,_++,_==4)break}}return[p,I]}function Ht(r,e){let t=new H(r,e,8),i=new H(r,e,8),s=new Array(r*e),n=new Array(r*e);for(let h=0;h<e;h++)for(let l=0;l<r;l++){let c=l+h*r,u=Math.abs(t.values[c]-i.values[c])*3-2,g=l/(r-1)*2-1,k=h/(e-1)*2-1;g<0&&(g=-g),k<0&&(k=-k);let y=g>=k?g:k;y=y*y*y*y,y=y*y*y*y,u=-u*1-2.2,u=u+1-y*20,u<-.25?s[c]=o.names.infiniteFall.id:s[c]=o.names.cloud.id}e:for(let h=0;h<r*e/50;h++){let l=O(r-2)+1,c=O(e-2)+1;for(let u=c-1;u<=c+1;u++)for(let g=l-1;g<=l+1;g++)if(s[g+u*r]!=o.names.cloud.id)continue e;s[l+c*r]=o.names.cloudCactus.id}let a=0;e:for(let h=0;h<r*e;h++){let l=O(r-2)+1,c=O(e-2)+1;for(let u=c-1;u<=c+1;u++)for(let g=l-1;g<=l+1;g++)if(s[g+u*r]!=o.names.cloud.id)continue e;if(s[l+c*r]=o.names.stairsDown.id,a++,a==2)break}return[s,n]}const ne=class extends ve{constructor(t){super();f(this,"xa",0);f(this,"ya",0);f(this,"lvl",0);f(this,"randomWalkTime",0);this.lvl=t,this.x=this.nextInt(64*16),this.y=this.nextInt(64*16),this.maxHealth=t*t*10,this.health=this.maxHealth}tick(){if(super.tick(),this.level.player!=null&&this.randomWalkTime==0){let i=this.level.player.x-this.x,s=this.level.player.y-this.y;i*i+s*s<50*50&&(this.xa=0,this.ya=0,i<0&&(this.xa=-1),i>0&&(this.xa=1),s<0&&(this.ya=-1),s>0&&(this.ya=1))}let t=this.tickTime&1;(!this.move(this.xa*t,this.ya*t)||this.nextInt(200)==0)&&(this.randomWalkTime=60,this.xa=(this.nextInt(3)-1)*this.nextInt(2),this.ya=(this.nextInt(3)-1)*this.nextInt(2)),this.randomWalkTime>0&&this.randomWalkTime--}render(t){let i=8;this.walkDist>>3&1,this.walkDist>>3&1,this.dir==1&&(i+=2),this.dir>1&&(this.walkDist>>4&1,this.dir==2,i+=4+(this.walkDist>>3&1)*2);let s=this.x-8,n=this.y-11;t.render(s+0,n+0,w.entities,i*8,0,0,0),t.render(s+8,n+0,w.entities,(i+1)*8,0,0,0),t.render(s+0,n+8,w.entities,i*8,8,0,0),t.render(s+8,n+8,w.entities,(i+1)*8,8,0,0)}touchedBy(t){t instanceof Z&&t.mobHurt(this,this.lvl+1,this.dir)}die(){super.die();const t=ne.nextInt(2)+1;for(let i=0;i<t;i++)this.level.add(new L(new M(d.cloth),this.x+ne.nextInt(11)-5,this.y+ne.nextInt(11)-5));this.level.player!=null&&(this.level.player.score+=50*this.lvl)}};let me=ne;f(me,"random",new Math.seedrandom),f(me,"nextInt",function(t){return Math.floor(ne.random.quick()*t)});const ke=class extends ve{constructor(t){super();f(this,"xa",0);f(this,"ya",0);f(this,"jumpTime",0);f(this,"lvl",0);this.lvl=t,this.x=this.nextInt(64*16),this.y=this.nextInt(64*16),this.maxHealth=t*t*5,this.health=this.maxHealth}tick(){super.tick();let t=1;if((!this.move(this.xa*t,this.ya*t)||this.nextInt(40)==0)&&this.jumpTime<=-10){if(this.xa=this.nextInt(3)-1,this.ya=this.nextInt(3)-1,this.level.player!=null){let i=this.level.player.x-this.x,s=this.level.player.y-this.y;i*i+s*s<50*50&&(i<0&&(this.xa=-1),i>0&&(this.xa=1),s<0&&(this.ya=-1),s>0&&(this.ya=1))}(this.xa!=0||this.ya!=0)&&(this.jumpTime=10)}this.jumpTime--,this.jumpTime==0&&(this.xa=0,this.ya=0)}die(){super.die();let t=this.nextInt(2)+1;for(let i=0;i<t;i++)this.level.add(new L(new M(d.slime),this.x+ke.nextInt(11)-5,this.y+ke.nextInt(11)-5));this.level.player!=null&&(this.level.player.score+=25*this.lvl)}render(t){let i=0,s=this.x-8,n=this.y-11;this.jumpTime>0&&(i+=2,n-=4),t.render(s+0,n+0,w.entities,i*8,0,0,0),t.render(s+8,n+0,w.entities,(i+1)*8,0,0,0),t.render(s+0,n+8,w.entities,i*8,8,0,0),t.render(s+8,n+8,w.entities,(i+1)*8,8,0,0)}touchedBy(t){t instanceof Z&&t.mobHurt(this,this.lvl,this.dir)}};let pe=ke;f(pe,"random",new Math.seedrandom),f(pe,"nextInt",function(t){return Math.floor(ke.random.quick()*t)});class de{constructor(e,t,i,s){this.random=new Math.seedrandom,this.w=e,this.h=t,this.tiles=[],this.entities=[],this.entitiesInTiles=[],this.depth=i,this.monsterDensity=8,this.entities=[],this.player=void 0,this.rowSprites=[],i<0&&(this.dirtColor=222);let n=[];if(i==0?n=Mt(e,t):i<0?(n=Rt(e,t,-i),this.monsterDensity=4):(n=bt(e,t),this.monsterDensity=4),this.tiles=n[0],this.data=n[1],s!==void 0){for(let a=0;a<t;a++)for(let h=0;h<e;h++)if(s.getTile(h,a)===o.names.stairsDown){this.setTile(h,a,o.names.stairsUp,0);let l=o.names.dirt;i==0&&(l=o.names.hardRock),this.setTile(h-1,a,l,0),this.setTile(h+1,a,l,0),this.setTile(h,a-1,l,0),this.setTile(h,a+1,l,0),this.setTile(h-1,a-1,l,0),this.setTile(h-1,a+1,l,0),this.setTile(h+1,a-1,l,0),this.setTile(h+1,a+1,l,0)}}this.entitiesInTiles=new Array(e*t);for(let a=0;a<e*t;a++)this.entitiesInTiles[a]=[];if(i===1){const a=new F;a.x=this.w*8,a.y=this.h*8,this.add(a)}}nextInt(e){return Math.floor(this.random.quick()*e)}renderBackground(e,t,i){let s=t>>4,n=i>>4,a=e.w+15>>4,h=e.h+15>>4;e.setOffset(t,i);for(let l=n-2;l<=h+n+2;l++)for(let c=s-2;c<=a+s+2;c++)this.getTile(c,l).render(e,this,c,l);e.setOffset(0,0)}renderSprites(e,t,i){let s=t>>4,n=i>>4,a=e.w+15>>4,h=e.h+15>>4;e.setOffset(t,i);for(let l=n-2;l<=h+n+2;l++){for(let c=s-2;c<=a+s+2;c++){if(c<0||l<0||c>=this.w||l>=this.h)continue;const u=this.entitiesInTiles[c+l*this.w];for(let g=0;g<u.length;g++)this.rowSprites.push(u[g])}this.rowSprites.length>0&&this.sortAndRender(e,this.rowSprites),this.rowSprites.length=0}e.setOffset(0,0)}renderLight(e,t,i){e.darkCtx.fillRect(0,0,e.darkCanvas.width,e.darkCanvas.height),e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height);let s=t>>4,n=i>>4,a=e.w+15>>4,h=e.h+15>>4,l=4;for(let c=n-l;c<=h+n+l;c++)for(let u=s-l;u<=a+s+l;u++){if(u<0||c<0||u>=this.w||c>=this.h)continue;let g=this.entitiesInTiles[u+c*this.w];for(let y=0;y<g.length;y++){let p=g[y],I=p.getLightRadius();I>0&&(e.ctx.beginPath(),e.ctx.arc(p.x-1-t,p.y-4-i,I*8,0,2*Math.PI),e.ctx.fill())}let k=this.getTile(u,c).getLightRadius(this,u,c);k>0&&(e.ctx.beginPath(),e.ctx.arc(u*16+8-t,c*16+8-i,k*8,0,2*Math.PI),e.ctx.fill())}e.darkCtx.globalCompositeOperation="xor",e.darkCtx.drawImage(e.canvas,0,0),e.darkCtx.globalCompositeOperation="source-over"}sortAndRender(e,t){t.sort(this.spriteSorter);for(let i=0;i<t.length;i++)t[i].render(e)}getTile(e,t){return e<0||t<0||e>=this.w||t>=this.h?o.names.rock:o.tiles[this.tiles[e+t*this.w]]}setTile(e,t,i,s){e<0||t<0||e>=this.w||t>=this.h||(this.tiles[e+t*this.w]=i.id,this.data[e+t*this.w]=s)}getData(e,t){return e<0||t<0||e>=this.w||t>=this.h?0:this.data[e+t*this.w]&255}setData(e,t,i){e<0||t<0||e>=this.w||t>=this.h||(this.data[e+t*this.w]=i)}add(e){e instanceof Z&&(this.player=e),e.removed=!1,this.entities.push(e),e.init(this),this.insertEntity(e.x>>4,e.y>>4,e)}remove(e){this.entities.splice(this.entities.indexOf(e),1);let t=e.x>>4,i=e.y>>4;this.removeEntity(t,i,e)}insertEntity(e,t,i){e<0||t<0||e>=this.w||t>=this.h||this.entitiesInTiles[e+t*this.w].push(i)}removeEntity(e,t,i){if(e<0||t<0||e>=this.w||t>=this.h)return;const s=this.entitiesInTiles[e+t*this.w];s.splice(s.indexOf(i),1)}trySpawn(e){for(let t=0;t<e;t++){let i,s=1,n=1;this.depth<0&&(n=-this.depth+1),this.depth>0&&(s=n=4);let a=this.nextInt(n-s+1)+s;this.nextInt(2)==0?i=new pe(a):i=new me(a),i.findStartPos(this)&&this.add(i)}}tick(){this.trySpawn(1);for(let e=0;e<this.w*this.h/50;e++){let t=this.nextInt(this.w),i=this.nextInt(this.h);this.getTile(t,i).tick(this,t,i)}for(let e=0;e<this.entities.length;e++){let t=this.entities[e],i=t.x>>4,s=t.y>>4;if(t.tick(),t.removed)this.entities.splice(e--,1),this.removeEntity(i,s,t);else{let n=t.x>>4,a=t.y>>4;(i!=n||s!=a)&&(this.removeEntity(i,s,t),this.insertEntity(n,a,t))}}}getEntities(e,t,i,s){let n=[],a=(e>>4)-1,h=(t>>4)-1,l=(i>>4)+1,c=(s>>4)+1;for(let u=h;u<=c;u++)for(let g=a;g<=l;g++){if(g<0||u<0||g>=this.w||u>=this.h)continue;let k=this.entitiesInTiles[g+u*this.w];for(let y=0;y<k.length;y++){let p=k[y];p.intersects(e,t,i,s)&&n.push(p)}}return n}}const re=class{constructor(e,t,i,s,n){f(this,"xOffset",0);f(this,"yOffset",0);f(this,"dither",[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5]);this.sheet=i,this.w=e,this.h=t,this.pixels=new Array(e*t),this.ctx=s,this.canvas=n,this.darkCtx=void 0,this.darkCanvas=void 0,this.isLightScreen=!1}setDarkness(e,t){this.darkCtx=e,this.darkCanvas=t,this.isLightScreen=!0,this.darkCtx.fillColor="black",this.ctx.fillColor="black"}clear(e){this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.w,this.h)}render(e,t,i,s,n,a,h){e-=this.xOffset,t-=this.yOffset;let l=(h&re.BIT_MIRROR_X)>0,c=(h&re.BIT_MIRROR_Y)>0;e<-16||e>this.w+16||t<-16||t>this.h+16||(l&&c?(this.ctx.scale(-1,-1),this.ctx.drawImage(i,s,n,8,8,-e-8,-t-8,8,8),this.ctx.scale(-1,-1)):l?(this.ctx.scale(-1,1),this.ctx.drawImage(i,s,n,8,8,-e-8,t,8,8),this.ctx.scale(-1,1)):c?(this.ctx.scale(1,-1),this.ctx.drawImage(i,s,n,8,8,e,-t-8,8,8),this.ctx.scale(1,-1)):this.ctx.drawImage(i,s,n,8,8,e,t,8,8))}renderTexture(e,t,i,s){e-=this.xOffset,t-=this.yOffset;let n=(s&re.BIT_MIRROR_X)>0,a=(s&re.BIT_MIRROR_Y)>0;e<-16||e>this.w+16||t<-16||t>this.h+16||(n&&a?(this.ctx.scale(-1,-1),this.ctx.drawImage(i,-e-8,-t-8,i.width,i.height),this.ctx.scale(-1,-1)):n?(this.ctx.scale(-1,1),this.ctx.drawImage(i,-e-8,t,i.width,i.height),this.ctx.scale(-1,1)):a?(this.ctx.scale(1,-1),this.ctx.drawImage(i,e,-t-8,i.width,i.height),this.ctx.scale(1,-1)):this.ctx.drawImage(i,e,t,i.width,i.height))}setOffset(e,t){this.xOffset=e,this.yOffset=t}overlay(e,t,i){e.isLightScreen?this.ctx.drawImage(e.darkCanvas,0,0):this.ctx.drawImage(e.canvas,0,0)}};let se=re;f(se,"BIT_MIRROR_X",1),f(se,"BIT_MIRROR_Y",2);class Le{constructor(e){this.game=e}tick(){}render(e){}renderItemList(e,t,i,s,n,a,h){let l=!0;h<0&&(h=-h-1,l=!1);const c=s-t,u=n-i-1,g=0;let k=a.length;k>u&&(k=u);let y=Math.floor(h-u/2);y>a.length-u&&(y=a.length-u),y<0&&(y=0);for(let p=g;p<k;p++)a[p+y].renderInventory(e,(1+t)*8,(p+1+i)*8);if(l){const p=h+1-y+i;b.draw(">",e,(t+0)*8,p*8,0),b.draw("<",e,(t+c)*8,p*8,0)}}}class Bt extends Le{constructor(e,t){super(e),this.selected=0,this.player=t}tick(){m.isClicked("MENU",T)&&this.game.clearMenu(),m.isClicked("MOVE_UP",T)&&this.selected--,m.isClicked("MOVE_DOWN",T)&&this.selected++;const e=this.player.inventory.items.length;e===0&&(this.selected=0),this.selected<0&&(this.selected+=e),this.selected>=e&&(this.selected-=e);for(let t=0;t<Me.length;t++)m.isClicked(Me[t])&&(this.player.hotbarItems[t]===this.player.inventory.items[this.selected]?this.player.setHotbarItem(t,void 0):this.player.setHotbarItem(t,this.player.inventory.items[this.selected]))}render(e){b.renderFrame(e,"inventory",1,1,12,11),this.renderItemList(e,1,1,12,11,this.player.inventory.items,this.selected)}}class Pe extends be{getColor(){return 0}getSprite(){return{sheet:w.items,sheetX:5*8,sheetY:0}}renderIcon(e,t,i){e.render(t,i,w.items,5*8,0,0,0)}renderInventory(e,t,i){e.render(t-2,i,w.items,5*8,0,0,0),b.draw("Pow glove",e,t+8,i,0)}getName(){return"Pow glove"}interact(e,t,i){return t instanceof ie?(t.take(e),!0):!1}}class te extends be{constructor(e){super(),this.placed=!1,this.furniture=e}renderIcon(e,t,i){e.render(t,i,this.furniture.iconSheet,this.furniture.iconX,this.furniture.iconY,this.furniture.col,0)}renderInventory(e,t,i){e.render(t,i,this.furniture.iconSheet,this.furniture.iconX,this.furniture.iconY,this.furniture.col,0),b.draw(this.furniture.name,e,t+8,i,0)}onTake(e){}canAttack(){return!1}getSprite(){return{sheet:this.furniture.iconSheet,sheetX:this.furniture.iconX,sheetY:this.furniture.iconY}}matches(e){return e instanceof te?this.furniture.constructor.name===e.furniture.constructor.name:!1}interactOn(e,t,i,s,n,a){return e.mayPass(t,i,s,this.furniture)?(this.furniture.x=i*16+8,this.furniture.y=s*16+8,t.add(this.furniture),this.placed=!0,!0):!1}isDepleted(){return this.placed}getName(){return this.furniture.name}}class ie extends he{constructor(e){super(),this.name=e,this.xr=3,this.yr=3,this.pushTime=0,this.pushDir=-1,this.col=0,this.shouldTake=void 0,this.sheet=w.entities,this.sheetX=0,this.sheetY=0,this.sprite={},this.iconSheet=w.items,this.iconX=0,this.iconY=0,this.setSprite()}setSprite(){this.sprite.sheet=this.sheet,this.sprite.sheetX=this.sheetX,this.sprite.sheetY=this.sheetY,this.sprite.iconSheet=this.iconSheet,this.sprite.iconX=this.iconX,this.sprite.iconY=this.iconY}tick(){this.shouldTake!==void 0&&(this.shouldTake.activeItem instanceof Pe&&(this.remove(),this.shouldTake.inventory.add(new te(this))),this.shouldTake=void 0),this.pushDir==0&&this.move(0,1),this.pushDir==1&&this.move(0,-1),this.pushDir==2&&this.move(-1,0),this.pushDir==3&&this.move(1,0),this.pushDir=-1,this.pushTime>0&&this.pushTime--}render(e){e.render(this.x-8,this.y-8-4,this.sheet,this.sheetX,this.sheetY,this.col,0),e.render(this.x-0,this.y-8-4,this.sheet,this.sheetX+8,this.sheetY,this.col,0),e.render(this.x-8,this.y-0-4,this.sheet,this.sheetX,this.sheetY+8,this.col,0),e.render(this.x-0,this.y-0-4,this.sheet,this.sheetX+8,this.sheetY+8,this.col,0)}blocks(e){return!0}touchedBy(e){e instanceof Z&&this.pushTime==0&&(this.pushDir=e.dir,this.pushTime=10)}take(e){this.shouldTake=e}}class $e extends ie{constructor(){super("Workbench"),this.xr=3,this.yr=2,this.sheetX=16*8,this.sheetY=26*8,this.iconX=4*8,this.iconY=26*8,this.setSprite()}use(e,t){return e.game.showCraftingMenu(),!0}}class Vt extends ie{constructor(){super("Oven"),this.xr=3,this.yr=2,this.sheetX=12*8,this.sheetY=26*8,this.iconX=2*8,this.iconY=26*8,this.setSprite()}use(e,t){return e.game.showOvenMenu(),!0}}class Nt extends ie{constructor(){super("Lantern"),this.xr=3,this.yr=2,this.sheetX=18*8,this.sheetY=26*8,this.iconX=5*8,this.iconY=26*8,this.setSprite()}getLightRadius(){return 8}}class Yt extends ie{constructor(){super("Furnace"),this.xr=3,this.yr=2,this.sheetX=14*8,this.sheetY=26*8,this.iconX=3*8,this.iconY=26*8,this.setSprite()}use(e,t){return e.game.showFurnaceMenu(),!0}}class Xt extends ie{constructor(){super("Chest"),this.sheetX=10*8,this.sheetY=26*8,this.iconX=1*8,this.iconY=26*8,this.inventory=new Je,this.setSprite()}use(e,t){return e.game.showContainerMenu(this.inventory),!0}}class Pt extends ie{constructor(){super("Anvil"),this.xr=3,this.yr=2,this.sheetX=8*8,this.sheetY=26*8,this.iconX=0*8,this.iconY=26*8,this.setSprite()}use(e,t){return e.game.showAnvilMenu(),!0}}function Gt(r,e){return e.canCraft&&!r.canCraft?1:!e.canCraft&&r.canCraft?-1:0}class Se extends Le{constructor(e,t,i){super(e),this.recipes=t,this.player=i,this.selected=0;for(let s=0;s<this.recipes.length;s++)this.recipes[s].checkCanCraft(this.player);this.recipes.sort(Gt)}tick(){m.isClicked("MENU",T)&&this.game.clearMenu(),m.isClicked("MOVE_UP",T)&&this.selected--,m.isClicked("MOVE_DOWN",T)&&this.selected++;const e=this.recipes.length;if(e===0&&(this.selected=0),this.selected<0&&(this.selected+=e),this.selected>=e&&(this.selected-=e),m.isClicked("ATTACK",T)&&e>0){const t=this.recipes[this.selected];t.checkCanCraft(this.player),t.canCraft&&(t.deductCost(this.player),t.craft(this.player));for(let i=0;i<this.recipes.length;i++)this.recipes[i].checkCanCraft(this.player)}}render(e){if(b.renderFrame(e,"Have",12,1,19,3),b.renderFrame(e,"Cost",12,4,19,11),b.renderFrame(e,"Crafting",0,1,11,11),this.renderItemList(e,0,1,11,11,this.recipes,this.selected),this.recipes.length>0){const t=this.recipes[this.selected],i=this.player.inventory.count(t.resultTemplate),s=13*8,{sheet:n,sheetX:a,sheetY:h}=t.resultTemplate.getSprite();e.render(s,2*8,n,a,h,t.resultTemplate.getColor(),0),b.draw(""+i,e,s+8,2*8,0);const l=t.costs;for(let c=0;c<l.length;c++){const u=l[c],g=(5+c)*8,k=u.getSprite();e.render(s,g,k.sheet,k.sheetX,k.sheetY,u.getColor(),0);let y=1;u instanceof M&&(y=u.count);let p=this.player.inventory.count(u),I=0;p<y&&(I=0),p>99&&(p=99),b.draw(""+y+"/"+p,e,s+8,g,I)}}}}class Ue{constructor(e){this.costs=[],this.canCraft=!1,this.resultTemplate=e}addCost(e,t){return this.costs.push(new M(e,t)),this}checkCanCraft(e){for(let t=0;t<this.costs.length;t++){const i=this.costs[t];if(!e.inventory.hasResource(i.resource,i.count)){this.canCraft=!1;return}}this.canCraft=!0}renderInventory(e,t,i){const s=this.resultTemplate.getSprite();e.render(t,i,s.sheet,s.sheetX,s.sheetY,0,0),b.draw(this.resultTemplate.getName(),e,t+8,i,0)}craft(e){}deductCost(e){for(let t=0;t<this.costs.length;t++){const i=this.costs[t];e.inventory.removeResource(i.resource,i.count)}}}class S extends Ue{constructor(e,t){super(new R(e,t)),this.toolType=e,this.level=t}craft(e){e.inventory.add(new R(this.toolType,this.level),0)}}class He extends Ue{constructor(e){super(new M(e,1)),this.resource=e}craft(e){e.inventory.add(new M(this.resource,1),0)}}class oe extends Ue{constructor(e){super(new te(new e.prototype.constructor)),this.furnitureClass=e}craft(e){e.inventory.add(new te(new this.furnitureClass.prototype.constructor),0)}}class C{}f(C,"anvilRecipes",[]),f(C,"ovenRecipes",[]),f(C,"furnaceRecipes",[]),f(C,"workbenchRecipes",[]);C.workbenchRecipes.push(new oe(Nt).addCost(d.wood,5).addCost(d.slime,10).addCost(d.glass,4));C.workbenchRecipes.push(new oe(Vt).addCost(d.stone,15));C.workbenchRecipes.push(new oe(Yt).addCost(d.stone,20));C.workbenchRecipes.push(new oe($e).addCost(d.wood,20));C.workbenchRecipes.push(new oe(Xt).addCost(d.wood,20));C.workbenchRecipes.push(new oe(Pt).addCost(d.ironIngot,5));C.workbenchRecipes.push(new S(v.sword,0).addCost(d.wood,5));C.workbenchRecipes.push(new S(v.axe,0).addCost(d.wood,5));C.workbenchRecipes.push(new S(v.hoe,0).addCost(d.wood,5));C.workbenchRecipes.push(new S(v.pickaxe,0).addCost(d.wood,5));C.workbenchRecipes.push(new S(v.shovel,0).addCost(d.wood,5));C.workbenchRecipes.push(new S(v.sword,1).addCost(d.wood,5).addCost(d.stone,5));C.workbenchRecipes.push(new S(v.axe,1).addCost(d.wood,5).addCost(d.stone,5));C.workbenchRecipes.push(new S(v.hoe,1).addCost(d.wood,5).addCost(d.stone,5));C.workbenchRecipes.push(new S(v.pickaxe,1).addCost(d.wood,5).addCost(d.stone,5));C.workbenchRecipes.push(new S(v.shovel,1).addCost(d.wood,5).addCost(d.stone,5));C.anvilRecipes.push(new S(v.sword,2).addCost(d.wood,5).addCost(d.ironIngot,5));C.anvilRecipes.push(new S(v.axe,2).addCost(d.wood,5).addCost(d.ironIngot,5));C.anvilRecipes.push(new S(v.hoe,2).addCost(d.wood,5).addCost(d.ironIngot,5));C.anvilRecipes.push(new S(v.pickaxe,2).addCost(d.wood,5).addCost(d.ironIngot,5));C.anvilRecipes.push(new S(v.shovel,2).addCost(d.wood,5).addCost(d.ironIngot,5));C.anvilRecipes.push(new S(v.sword,3).addCost(d.wood,5).addCost(d.goldIngot,5));C.anvilRecipes.push(new S(v.axe,3).addCost(d.wood,5).addCost(d.goldIngot,5));C.anvilRecipes.push(new S(v.hoe,3).addCost(d.wood,5).addCost(d.goldIngot,5));C.anvilRecipes.push(new S(v.pickaxe,3).addCost(d.wood,5).addCost(d.goldIngot,5));C.anvilRecipes.push(new S(v.shovel,3).addCost(d.wood,5).addCost(d.goldIngot,5));C.anvilRecipes.push(new S(v.sword,4).addCost(d.wood,5).addCost(d.gem,50));C.anvilRecipes.push(new S(v.axe,4).addCost(d.wood,5).addCost(d.gem,50));C.anvilRecipes.push(new S(v.hoe,4).addCost(d.wood,5).addCost(d.gem,50));C.anvilRecipes.push(new S(v.pickaxe,4).addCost(d.wood,5).addCost(d.gem,50));C.anvilRecipes.push(new S(v.shovel,4).addCost(d.wood,5).addCost(d.gem,50));C.furnaceRecipes.push(new He(d.ironIngot).addCost(d.ironOre,4).addCost(d.coal,1));C.furnaceRecipes.push(new He(d.goldIngot).addCost(d.goldOre,4).addCost(d.coal,1));C.furnaceRecipes.push(new He(d.glass).addCost(d.sand,4).addCost(d.coal,1));C.ovenRecipes.push(new He(d.bread).addCost(d.wheat,4));class Ut extends Le{constructor(e,t,i){super(e),this.inventory=t,this.player=i,this.selected=0,this.otherSelected=0}tick(){if(m.isClicked("MENU",T)&&this.game.clearMenu(),m.isClicked("MOVE_LEFT",T)){this.window=0;let s=this.selected;this.selected=this.otherSelected,this.otherSelected=s}if(m.isClicked("MOVE_RIGHT",T)){this.window=1;let s=this.selected;this.selected=this.otherSelected,this.otherSelected=s}let e,t;this.window===0?(e=this.inventory,t=this.player.inventory):(e=this.player.inventory,t=this.inventory),m.isClicked("MOVE_UP",T)&&this.selected--,m.isClicked("MOVE_DOWN",T)&&this.selected++;const i=e.items.length;if(i===0&&(this.selected=0),this.selected<0&&(this.selected+=i),this.selected>=i&&(this.selected-=i),m.isClicked("ATTACK",T)&&i>0){const s=e.items[this.selected];e.removeItem(s),t.add(s,this.otherSelected),this.selected>=e.items.length&&(this.selected=e.items.length-1)}}render(e){this.window==1&&e.setOffset(6*8,0),b.renderFrame(e,"Chest",1,1,12,11),this.renderItemList(e,1,1,12,11,this.inventory.items,this.window==0?this.selected:-this.otherSelected-1),b.renderFrame(e,"Inventory",13,1,13+11,11),this.renderItemList(e,13,1,13+11,11,this.player.inventory.items,this.window==1?this.selected:-this.otherSelected-1),e.setOffset(0,0)}}class Ft extends Le{constructor(e,t){super(e),this.time=0,this.direction=t}tick(){this.time+=1,this.time===15?this.game.changeLevel(this.direction):this.time===30&&this.game.clearMenu()}render(e){for(let t=0;t<e.w/3;t++)for(let i=0;i<e.h/3;i++){const s=i+t%2*2+t/3-this.time;s>0||s<-15||(this.direction>0?e.render(t*8,i*8,w.tiles,6*8,22*8,0,0):e.render(t*8,e.h-i*8,w.tiles,6*8,22*8,0,0))}}}const J=document.getElementById("canvas"),Wt=J.getContext("2d"),U=document.createElement("canvas"),we=U.getContext("2d"),ae=document.createElement("canvas"),Fe=ae.getContext("2d"),Be=document.createElement("canvas"),zt=Be.getContext("2d"),qt=60,je=8,Kt=15,Jt=20,Ve=je*Kt,Ne=je*Jt;J.height=Ve;J.width=Ne;U.height=Ve;U.width=Ne;ae.height=Ve;ae.width=Ne;Be.height=Ve;Be.width=Ne;we.fillRect(0,0,J.width,J.height);we.imageSmoothingEnabled=!1;Fe.fillRect(0,0,J.width,J.height);Fe.imageSmoothingEnabled=!1;function et(r){let e=r.target.innerWidth;const t=r.target.innerHeight;e*.75>t&&(e=Math.floor(t*20/15)),J.style.width=e+"px"}window.addEventListener("resize",et);et({target:{innerWidth:window.innerWidth,innerHeight:window.innerHeight}});class Zt{constructor(){this.ticks=0,this.nextTick=0,this.isInMenu=!1,this.menu=void 0;const e=new Array(5);e[4]=new de(128,128,1,void 0),e[3]=new de(128,128,0,e[4]),e[2]=new de(128,128,-1,e[3]),e[1]=new de(128,128,-2,e[2]),e[0]=new de(128,128,-3,e[1]),this.levels=e,this.currentLevel=3,this.pendingLevelChange=0,this.level=this.levels[this.currentLevel],this.screen=new se(U.width,U.height,void 0,we,U),this.lightScreen=new se(ae.width,ae.height,void 0,Fe,ae),this.lightScreen.setDarkness(zt,Be),this.player=new Z(this),this.player.findStartPos(this.level),this.level.add(this.player);for(let t=0;t<this.levels.length;t++)this.levels[t].trySpawn(5e3);this.ts=Date.now()/1e3,this.player.inventory.add(new te(new $e)),this.player.inventory.add(new Pe)}scheduleLevelChange(e){this.pendingLevelChange=e}changeLevel(e){this.level.remove(this.player),this.currentLevel+=e,this.level=this.levels[this.currentLevel],this.player.x=(this.player.x>>4)*16+8,this.player.y=(this.player.y>>4)*16+8,this.level.add(this.player)}clearMenu(){this.menu=void 0}showCraftingMenu(){this.menu=new Se(this,C.workbenchRecipes,this.player)}showOvenMenu(){this.menu=new Se(this,C.ovenRecipes,this.player)}showFurnaceMenu(){this.menu=new Se(this,C.furnaceRecipes,this.player)}showContainerMenu(e){this.menu=new Ut(this,e,this.player)}showAnvilMenu(){this.menu=new Se(this,C.anvilRecipes,this.player)}showInventoryMenu(){this.menu=new Bt(this,this.player)}update(){this.menu===void 0?(this.pendingLevelChange!==0&&(this.menu=new Ft(this,this.pendingLevelChange),this.pendingLevelChange=0),this.level.tick()):this.menu.tick(),m.isClicked("DEBUG_1",T)&&this.findStairsDown(),m.isClicked("DEBUG_2",T)&&this.findStairsUp(),m.isClicked("DEBUG_3",T)&&this.moveAirWizard()}moveAirWizard(){if(this.level.depth!==1)return;const e=this.level.entities;for(let t=0;t<e.length;t++){const i=e[t];if(i instanceof F){i.x=this.player.x+16,i.y=this.player.y+16;return}}}findStairsDown(){for(let e=0;e<this.level.tiles.length;e++)if(this.level.tiles[e]==o.names.stairsDown.id){this.player.x=e%128*16+32,this.player.y=Math.floor(e/128)*16;break}}findStairsUp(){for(let e=0;e<this.level.tiles.length;e++)if(this.level.tiles[e]==o.names.stairsUp.id){this.player.x=e%128*16+32,this.player.y=Math.floor(e/128)*16;break}}renderCanvasGUI(){for(let e=0;e<10;e++)e<this.player.health?this.screen.render(1+e*8,this.screen.h-16,w.gui,0,2*8,0,0):this.screen.render(1+e*8,this.screen.h-16,w.gui,0,3*8,0,0),e<this.player.stamina?this.screen.render(1+e*8,this.screen.h-8,w.gui,8,2*8,0,0):this.screen.render(1+e*8,this.screen.h-8,w.gui,8,3*8,0,0);for(let e=0;e<10;e+=2){const t=e/2;if(this.screen.render(82-t+e*8,this.screen.h-16,w.gui,2*8,4*8,0,0),this.screen.render(82-t+(e+1)*8,this.screen.h-16,w.gui,2*8,4*8,0,1),this.screen.render(82-t+e*8,this.screen.h-8,w.gui,2*8,4*8,0,2),this.screen.render(82-t+(e+1)*8,this.screen.h-8,w.gui,2*8,4*8,0,3),this.player.activeItemIndex===t&&(this.screen.render(82-t+e*8,this.screen.h-16,w.gui,2*8,5*8,0,0),this.screen.render(82-t+(e+1)*8,this.screen.h-16,w.gui,2*8,5*8,0,1),this.screen.render(82-t+e*8,this.screen.h-8,w.gui,2*8,5*8,0,2),this.screen.render(82-t+(e+1)*8,this.screen.h-8,w.gui,2*8,5*8,0,3)),this.player.hotbarItems[t]!==void 0){const i=this.player.hotbarItems[t];let s=i.count;if(s>99&&(s=99),i instanceof M)b.draw(""+s,this.screen,82+e*8-t,this.screen.h-8,0),this.screen.render(82+e*8+4-t,this.screen.h-15,i.resource.sheet,i.resource.sheetX,i.resource.sheetY,0,0);else if(i instanceof te)this.screen.render(82+e*8+4-t,this.screen.h-12,i.furniture.iconSheet,i.furniture.iconX,i.furniture.iconY,0,0);else if(i instanceof R){const n=i.getSprite();this.screen.render(82+e*8+4-t,this.screen.h-12,n.sheet,n.sheetX,n.sheetY,0,0)}else i instanceof Pe&&i.renderIcon(this.screen,82+e*8+4-t,this.screen.h-12)}}}draw(){let e=this.player.x-this.screen.w/2,t=this.player.y-this.screen.h/2;e<16&&(e=16),t<16&&(t=16),e>this.level.w*16-this.screen.w-16&&(e=this.level.w*16-this.screen.w-16),t>this.level.h*16-this.screen.h-16&&(t=this.level.h*16-this.screen.h-16),this.level.renderBackground(this.screen,e,t),this.level.renderSprites(this.screen,e,t),this.currentLevel<3&&(this.level.renderLight(this.lightScreen,e,t),this.screen.overlay(this.lightScreen,e,t)),this.renderCanvasGUI(),this.menu!==void 0&&this.menu.render(this.screen)}loop(){const e=Date.now()/1e3,t=e-this.ts;for(this.ts=e,this.ticks+=t*qt;this.nextTick<=this.ticks;)this.update(),this.nextTick+=1,o.tickCount++;we.fillStyle="#000",we.fillRect(0,0,U.width,U.height),this.draw(),Wt.drawImage(U,0,0),window.requestAnimationFrame(this.boundLoop)}start(){window.requestAnimationFrame(this.boundLoop)}}async function Qt(){const r=await lt("/assets/minicho.json");ot(r);const e=new Zt;e.boundLoop=e.loop.bind(e),e.start()}Qt();
